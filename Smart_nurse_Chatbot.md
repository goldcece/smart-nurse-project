

# NANDA 2.0 :** μ‹¤μµμ© μ „μκ°„νΈκΈ°λ΅μ‹μ¤ν… LLM μ μ© / μ „μκ°„νΈκΈ°λ΅ λ¬Έκµ¬ μ‘λ™ μ‘μ„± μ‹μ¤ν… 

π€ν€μ¥ : ν™©μ¬μ—°

βοΈν€μ› : μ•μ§€μ€, ν™μ„Έν—, λ°•μ•„μ

π—„οΈRepository : [https://github.com/SmartNurse/Year_Dream](https://github.com/SmartNurse/Year_Dream)

---

- **λ©μ°¨**
    1. [ν”„λ΅μ νΈ κ°μ”]
    2. [λ°μ΄ν„° EDA]
        1. λ°μ΄ν„° ν„ν™©
        2. 1μ°¨ μ „μ²λ¦¬
        3. 2μ°¨ μ „μ²λ¦¬
        4. LLM ν•™μµ λ°μ΄ν„°μ…‹ μ μ‘
    3. [Model : Fine-tuning & LLM ν•™μµ]
        1. GPT API : Microsoft Azure Open AI
        2. GPT Fine-tuning
        3. LLM ν•™μµ
    4. [μ„λΉ„μ¤ κµ¬ν„ λ° λ°°ν¬]
        1. Chatbot : Langchain 
        2. Webapp deployment : Streamlit 



    

# 1. ν”„λ΅μ νΈ **κ°μ”**

β¨ν”„λ΅μ νΈ ν•„μ”μ„± (λ¬Έμ  μ μ‹)

![α„‡α…΅α†―α„‘α…­α„α…΅α„…α…­.001.png](Smart_nurse_Chatbot/prologue.png)

![κ°„νΈλ€ν•™μƒ λ° μ‹ κ·κ°„νΈμ‚¬λ¥Ό μ„ν• DK Medi Info μ Smart Nurse ENR μ‹μ¤ν…](Smart_nurse_Chatbot/smartnursesystem.png)

κ°„νΈλ€ν•™μƒ λ° μ‹ κ·κ°„νΈμ‚¬λ¥Ό μ„ν• DK Medi Info μ Smart Nurse ENR μ‹μ¤ν…

### **β¨ν”„λ΅μ νΈ λ©ν‘**

- μ „μ κ°„νΈκΈ°λ΅ λ°μ΄ν„° κΈ°λ° μ‹¤μµμ© μ „μ κ°„νΈκΈ°λ΅ λ¬Έκµ¬ μλ™ μƒμ„± μ±—λ΄‡ μ‹μ¤ν… κµ¬ν„

### β¨Work Flow

- **λ°μ΄ν„° μ „μ²λ¦¬ β†’ LLM λ¨λΈ Fine-tuning  β†’ Prompt fine-tuning β†’ μ±—λ΄‡ μ„λΉ„μ¤ κµ¬ν„ β†’ μ›Ήμ•± λ°°ν¬**
    
    ![work flow](Smart_nurse_Chatbot/work_flow.001.png)
    
    work flow
    

### β¨μ‚¬μ©ν• ν΄

- GPT-3.5 turbo (Azure Open AI) : Pretrained LLM Model
- (ν•μ΄νΌν΄λ΅λ°”X) : Pretrained LLM Model
- Langchain : Chatbot implementation
- Streamlit : Webapp deployment

### β¨Β μ©μ–΄ μ„¤λ…

- μ¤λ§νΈλ„μ¤μ—μ„ μ κ³µν•λ” μ£Όμ” κ°„νΈκΈ°λ΅ μ–‘μ‹
    - NANDA : λ¶λ―Έ κ°„νΈν‘ν ν‘μ¤€ μ§„λ‹¨μ΄ ν¬ν•¨λ κΈ°λ΅ μ²΄κ³„
        - [domain, class, diagnosis, μλ£, κ°„νΈ λ©ν‘, κ°„νΈ κ³„ν] λ“± ν¬ν•¨
    - SOAPIE : λ¬Έμ μ¤‘μ‹¬ κΈ°λ΅μ²΄κ³„
        - [μ£Όκ΄€μ  μλ£, κ°κ΄€μ  μλ£, κ°„νΈμ‚¬μ •, κ°„νΈκ³„ν, μ¤‘μ¬, ν‰κ°€] λ‚΄μ© ν¬ν•¨
    - Focus DAR : ν•µμ‹¬ μ¤‘μ‹¬ κΈ°λ΅μ²΄κ³„
        - [ν•µμ‹¬, μλ£(μ£Όκ΄€μ /κ°κ΄€μ ), κ°„νΈν™λ™, ν™μλ°μ‘] λ‚΄μ© ν¬ν•¨
    - μ„μ κΈ°λ΅(Narrative Note) : μ‹κ°„ κ²½κ³Όμ— λ”°λ¥Έ μ „ν†µμ μΈ κΈ°λ΅λ°©λ²•
    
    ![μ¤λ§νΈλ„μ¤ μ‹μ¤ν… κ°„νΈκΈ°λ΅ μ–‘μ‹ μμ‹](Smart_nurse_Chatbot/record.001.png)
    
    μ¤λ§νΈλ„μ¤ μ‹μ¤ν… κ°„νΈκΈ°λ΅ μ–‘μ‹ μμ‹
    

# 2. λ°μ΄ν„° EDA

### a. λ°μ΄ν„° ν„ν™©

- DK Medi Info μ Smart Nurse ENR μ‹μ¤ν…μ— μ €μ¥λ μμ—°μ–΄ κ°„νΈκΈ°λ΅ λ°μ΄ν„°
- λ°μ΄ν„°μ μ : *18,400+ (NCP + AWS DB)*
    - NANDA : *1,900+*
        
        ![μ¤ν¬λ¦°μƒ· 2023-11-30 210912.png](Smart_nurse_Chatbot/rawdata.png)
        
    - SOAPIE : *900+*
        
        ![μ¤ν¬λ¦°μƒ· 2023-11-30 211048.png](Smart_nurse_Chatbot/raw_soapie.png)
        
    - Focus_DAR : *2,200+*
        
        ![μ¤ν¬λ¦°μƒ· 2023-11-30 211151.png](Smart_nurse_Chatbot/raw_focusdar.png)
        
    - Narrative Note : *13,000+*
        
        ![μ¤ν¬λ¦°μƒ· 2023-11-30 211333.png](Smart_nurse_Chatbot/raw_narrnote.png)
        
    - Nursing Data: *400+*
        
        ![μ¤ν¬λ¦°μƒ· 2023-11-30 211421.png](Smart_nurse_Chatbot/rawraw.png)
        

![data.png](Smart_nurse_Chatbot/data.png)

<aside>
π’΅ NaN, νΉμλ¬Έμ, μ«μ, ν•κΈ€ μμ, μ•νλ²³, λ…Έλκ°€μ‚¬, μ–΄μƒ‰ν• λ¬Έμ¥ λ“± μλ» μ‘μ„±λ raw λ°μ΄ν„° ν™•μΈ

</aside>



---

### b. 1μ°¨ μ „μ²λ¦¬

- raw data μ§μ ‘ κ²€μ
- μ •κ·ν‘ν„μ‹ μ½”λ“ μ‘μ„±
    - μ½”λ“
        
        ```python
        # ν•„ν„°λ§ μ΅°κ±΄μ— λ§μ§€ μ•λ” ν–‰μ„ ν™•μΈν•λ” ν•¨μ
        def is_valid_row(text):
            # μ«μλ§ / μ•νλ²³λ§ / ν•κΈ€μλ¨μλ§ / νΉμ λ¬Έμλ§ μλ” κ²½μ°
            if re.fullmatch(r'\d+', text) or re.fullmatch(r'[a-zA-Z]+', text) or re.fullmatch(r'[γ„±-γ…γ…-γ…£]+', text) or re.fullmatch(r'[^\w\s]+', text):
                return False
            return True
        
        # ν•„ν„°λ§ μ΅°κ±΄μ— λ§μ§€ μ•λ” λ‹¨μ–΄λ¥Ό μ κ±°ν•λ” ν•¨μ
        def remove_invalid_words(text)
            words = str(text).split()
            valid_words = [word for word in words if is_valid_row(word)]
            return ' '.join(valid_words) if valid_words else pd.NA  # λΉ λ¬Έμμ—΄ λ€μ‹  pd.NA λ°ν™
        
        # κΈΈμ΄κ°€ n λ―Έλ§μΈ λ°μ΄ν„°κ°€ μλ” ν–‰ μ κ±°
        def remove_short_words(text):
            # λ¬Έμμ—΄λ΅ λ³€ν™ν•κ³  λ‹¨μ–΄λ΅ λ¶„λ¦¬
            words = str(text).split()
            # κΈΈμ΄κ°€ 3 μ΄κ³ΌμΈ λ‹¨μ–΄λ§ μ ν¨ν•λ‹¤κ³  νλ‹¨
            valid_words = [word for word in words if len(word) > 3]
            # μ ν¨ν• λ‹¨μ–΄λ“¤μ„ λ‹¤μ‹ λ¬Έμμ—΄λ΅ ν•©μΉκΈ°
            return ' '.join(valid_words) if valid_words else pd.NA
        
        # λ™μμ΄μμ–΄ μ κ±°
        def unify_terms(sentence):
            S_patterns_to_unify = [
                r'<μ£Όκ΄€μ (?![\]μλ£])',
                r'\[μ£Όκ΄€μ \]',
                r'μ£Όκ΄€μ :',
                r'-μ£Όκ΄€μ :',
                r'μ£Όκ΄€μ μλ£:',
                r'\[μ£Όκ΄€μ μλ£\]',
                r'μ£Όκ΄€μ μλ£(?!\])',
                r'\<μ£Όκ΄€μ μλ£\>',
                r'\[μ£Όκ΄€μ ',
                r'\*μ£Όκ΄€μ ',
                r'\(μ£Όκ΄€μ \)',
                r'\(μ£Όκ΄€μ ',
                r'μ£Όκ΄€μ -λ³΄νΈμ',
                r'\(\[μ£Όκ΄€μ μλ£\]\)',
                r'-\[μ£Όκ΄€μ μλ£\]',
                r'\*\[μ£Όκ΄€μ μλ£\]',
            ]
        
            O_patterns_to_unify = [
                r'<κ°κ΄€μ (?![\]μλ£])',
                r'\[κ°κ΄€μ \]',
                r'κ°κ΄€μ :',
                r'-κ°κ΄€μ :',
                r'κ°κ΄€μ μλ£:',
                r'\[κ°κ΄€μ μλ£\]',
                r'κ°κ΄€μ μλ£(?!\])',
                r'\<κ°κ΄€μ μλ£\>',
                r'\[κ°κ΄€μ ',
                r'\*κ°κ΄€μ ',
                r'\(κ°κ΄€μ \)',
                r'\(κ°κ΄€μ ',
                r'κ°κ΄€μ -λ³΄νΈμ',
                r'\(\[κ°κ΄€μ μλ£\]\)',
                r'-\[κ°κ΄€μ μλ£\]',
                r'\*\[κ°κ΄€μ μλ£\]',
            ]
            ST_patterns_to_unitfy = [
                r'λ‹¨κΈ°λ©ν‘:',
                r'\<λ‹¨κΈ°λ©ν‘\>',
                r'λ‹¨κΈ°λ©ν‘',
                r'-λ‹¨κΈ°λ©ν‘',
                r'λ‹¨κΈ°',
                r'λ‹¨κΈ°:',
                r'\[λ‹¨κΈ°\]',
                r'\<λ‹¨κΈ°\>',
                r'\*λ‹¨κΈ°λ©ν‘:',
                r'\*\[λ‹¨κΈ°λ©ν‘\]',
                r'\*λ‹¨κΈ°:',
                r'\*\<λ‹¨κΈ°λ©ν‘\>',
                r'\*λ‹¨κΈ°λ©ν‘',
                r'\[λ‹¨κΈ°λ©ν‘\]\)',
                r'\(\[λ‹¨κΈ°λ©ν‘\]\)'
            ]
            LT_patterns_to_unitfy = [
                r'μ¥κΈ°λ©ν‘:',
                r'\<μ¥κΈ°λ©ν‘\>',
                r'μ¥κΈ°λ©ν‘',
                r'-μ¥κΈ°λ©ν‘',
                r'μ¥κΈ°',
                r'μ¥κΈ°:',
                r'\[μ¥κΈ°\]',
                r'\<μ¥κΈ°\>',
                r'\*μ¥κΈ°λ©ν‘:',
                r'\*\[μ¥κΈ°λ©ν‘\]',
                r'\*μ¥κΈ°:',
                r'\*\<μ¥κΈ°λ©ν‘\>',
                r'\*μ¥κΈ°λ©ν‘',
                r'\[μ¥κΈ°λ©ν‘\]\)',
                r'\(\[μ¥κΈ°λ©ν‘\]\)'
        
            ]
        
            for pattern in S_patterns_to_unify:
              sentence = re.sub(pattern, '[μ£Όκ΄€μ μλ£]', sentence)
        
            for pattern in O_patterns_to_unify:
              sentence = re.sub(pattern, '[κ°κ΄€μ μλ£]', sentence)
        
            for pattern in ST_patterns_to_unitfy:
              sentence = re.sub(pattern, '[λ‹¨κΈ°λ©ν‘]', sentence)
        
            for pattern in LT_patterns_to_unitfy:
              sentence = re.sub(pattern, '[μ¥κΈ°λ©ν‘]', sentence)
        
            # '[μ£Όκ΄€μ μλ£]μλ£]'μ™€ κ°™μ€ ν¨ν„΄μ„ '[μ£Όκ΄€μ μλ£]'λ΅ μΉν™
            sentence = re.sub(r'\[μ£Όκ΄€μ μλ£\](μλ£\])+', '[μ£Όκ΄€μ μλ£]', sentence)
            sentence = re.sub(r'\[κ°κ΄€μ μλ£\](μλ£\])+', '[κ°κ΄€μ μλ£]', sentence)
            sentence = re.sub(r'\[\[\[λ‹¨κΈ°λ©ν‘\]λ©ν‘\]\]', '[λ‹¨κΈ°λ©ν‘]', sentence)
            sentence = re.sub(r'\[\[λ‹¨κΈ°λ©ν‘\]λ©ν‘\]', '[λ‹¨κΈ°λ©ν‘]', sentence)
            sentence = re.sub(r'\[λ‹¨κΈ°λ©ν‘\]:', '[λ‹¨κΈ°λ©ν‘]', sentence)
            sentence = re.sub(r'\[\[\[μ¥κΈ°λ©ν‘\]λ©ν‘\]\]', '[μ¥κΈ°λ©ν‘]', sentence)
            sentence = re.sub(r'\[\[μ¥κΈ°λ©ν‘\]λ©ν‘\]', '[μ¥κΈ°λ©ν‘]', sentence)
            sentence = re.sub(r'\[μ¥κΈ°λ©ν‘\]:', '[μ¥κΈ°λ©ν‘]', sentence)
            return sentence
        
        # μ¤‘λ³µ ν–‰ μ κ±°
        def check_row_for_duplicates(row):
            row_values = row.tolist()
            return len(row_values) != len(set(row_values))
        
        # μ„ μ „μ²λ¦¬ ν•¨μλ“¤μ„ μ μ©ν•λ” ν•¨μ
        def function_apply(df, filter_column) :
            # λ¨λ“  μ—΄μ— μ μ©
            for column in df.columns :
                df[column] = df[column].apply(remove_invalid_words)
        
            # filterλ μ—΄μ—λ§ μ μ©
            for column in filter_column :
                df[column] = df[column].apply(remove_short_words)
        
            # ν–‰λ³„λ΅ μ μ©
            df = df[~df.apply(check_row_for_duplicates, axis = 1)]
        
            # '<NA>'κ°€ ν¬ν•¨λ ν–‰ μ κ±°
            df = df[~df.apply(lambda x: x.astype(str).str.contains('<NA>')).any(axis=1)]
            df = df.reset_index(drop=True)
        
            # λ¨λ“  ν–‰ λ™μμ΄μμ–΄ μ²λ¦¬
            for column in df.columns:
              df[column] = df[column].apply(unify_terms)
        
            return df
        ```
        
    - μ „κ³Ό ν›„ λΉ„κµ
        
        ![**μ „μ²λ¦¬(μ „)**](Smart_nurse_Chatbot/predata.png)
        
        **μ „μ²λ¦¬(μ „)**
        
        ![μ¤ν¬λ¦°μƒ· 2023-11-30 213046.png](Smart_nurse_Chatbot/pro_data.png)
        
        μ „μ²λ¦¬(ν›„)
        
    

**μ΄μ λ° ν•κ³„μ **

- λ¶μ©μ–΄ μ²λ¦¬ μ½”λ“λ΅ μΈν•΄ μλ―Έμλ” λ‹¨μ–΄λ„ μ‚­μ λλ” κ²½μ° λ°μƒ
- λ„λ©”μΈμ— νΉν™”λ μμ—°μ–΄ λ°μ΄ν„° μ²λ¦¬μ μ–΄λ ¤μ›€ β†’ μ μλ―Έν• μ •λ³΄μ™€ λ¬΄μλ―Έν• μ •λ³΄μ κµ¬λ¶„ λ° μ·¨μ‚¬μ„ νƒ
- λ°μ΄ν„° μ „μ²λ¦¬λ¥Ό κΌΌκΌΌν•κ² ν• μλ΅ μ‚¬μ©ν•  μ μλ” λ°μ΄ν„°μ μκ°€ μ¤„μ–΄λ“¬ β†’ ν•™μµμ΄ μ λμ§€ μ•μ„ κ°€λ¥μ„±
- μ‹¤μµμ©(κµμ΅μ©) λ°μ΄ν„°μ ν•κ³„ β†’ μλ£μ—…κ³„λ” μ •ν™•ν• λ°μ΄ν„°κ°€ μ¤‘μ”ν•λ° κ·Έλ ‡μ§€ λ»ν• κ²½μ°κ°€ λ§μ•μ
- λ°μ΄ν„° μ „μ²λ¦¬μ— λ§μ€ μ‹κ°„ μ†μ” β†’ κ·Έλ¬λ‚ **λ°μ΄ν„°μ „μ²λ¦¬λ” ν•κΈ€ μμ—°μ–΄μ²λ¦¬ κ³Όμ μ ν•µμ‹¬**

### c. 2μ°¨ μ „μ²λ¦¬

- ν•™μµ λ°μ΄ν„°μ…‹μ—μ„ μ΄ 17κ°μ λΉμ¶ λ³‘λ… μ¶”μ¶
    - `λΉ„ν¨κ³Όμ  νΈν΅ μ–‘μƒ / λΉ„ν¨κ³Όμ  κΈ°λ„μ²­κ²° / κ°€μ¤κµν™ μ¥μ•  / λ‚™μƒμ μ„ν— / λ¶μ•μ •ν• νμ••μ μ„ν— / κ·Όμ΅μ κΈ΄μ¥ / μ¶©μμ—ΌμΌλ΅ μΈν• λ³µν†µ / μ™Έμƒμ„± μ§€μ£Όλ§‰ν• μ¶ν / λ‹Ήλ‡¨λ³‘ / λ¬΄λ¦κ΄€μ μ¦ / ν‡΄ν–‰μ„± κ΄€μ μ—Ό / ν†µμ¦ / μ•μ°½ / μλ°μ  ν™κΈ°μ¥μ•  / κΈ‰μ„±ν†µμ¦ / κ³ μ²΄μ¨ / λ¶„λ§ ν†µμ¦`
        
        ![μ¤ν¬λ¦°μƒ· 2023-11-30 224302.png](Smart_nurse_Chatbot/frequent.png)
        
    - μ¶”μ¶ν• λ³‘λ… ν‚¤μ›λ“ λ³„λ΅ λ°μ΄ν„°λ¥Ό λ¶„λ¥ν•μ—¬ κµ¬μ²΄μ μΌλ΅ μ „μ²λ¦¬
        - Langchain GPT prompting μ„ ν™μ©ν•μ—¬ μ–‘μ‹λ³„ λ°μ΄ν„° μ „μ²λ¦¬(λ§μ¶¤λ²• λ“±)
        - μ½”λ“
            
            ```python
            import pandas as pd
            from langchain.chat_models import AzureChatOpenAI
            from langchain.prompts import ChatPromptTemplate
            
            # Azure OpenAIλ¥Ό μ‚¬μ©ν•λ” κ°μ²΄ μƒμ„±
            chat = AzureChatOpenAI(
                deployment_name='λ¨λΈ',
                model_name='gpt-35-turbo',
            )
            
            # ν•κµ­μ–΄ ν”„λ΅¬ν”„νΈ ν…ν”λ¦Ώ μƒμ„±
            prompt = ChatPromptTemplate.from_messages(
                [
                    (
                        "system",
                        
                        """ λ‹Ήμ‹ μ€ κ°„νΈκΈ°λ΅ μ‘μ„±μ§€λ¥Ό μ‘μ„±ν•΄μ£Όλ” μ „λ¬Έκ°€μ…λ‹λ‹¤. λ‹¤μμ μλ£κΈ°λ΅μ„ λ¶„μ„ν•κ³  μ¤‘κ°„μ— λκΈ΄ λ¬Έμ¥μ΄ μκ±°λ‚ μ¤νƒμκ°€ μμΌλ©΄ μ•λ§κ² μμ •ν•κ³  NANDA ν•μ‹μΌλ΅ μ¶λ ¥ν•μ„Έμ”.
                        ν•κΈ€λ΅ μ‘μ„±ν•μ„Έμ”.
                        """,
                    ),
                    ("human", "{medical_record}"),
                ]
            )
            
            # ν”„λ΅¬ν”„νΈμ™€ μ±„ν… λ¨λΈ κ²°ν•©
            chain = prompt | chat  
            
            # CSV νμΌμ—μ„ λ°μ΄ν„° λ¶λ¬μ¤κΈ°
            pd.read_csv("κ° μ „μ²λ¦¬ν• νμΌ κ²½λ΅")
            
            # μƒλ΅μ΄ λ°μ΄ν„°μ…‹
            new_dataset = []
            
            # κ° ν–‰ μ²λ¦¬
            for index, row in df.iterrows():
                response = chain.invoke({"medical_record": row['input']})
                new_dataset.append({'input': row['input'], 'output': response})
                print(response)
                
            
            # μƒλ΅μ΄ λ°μ΄ν„°μ…‹μ„ DataFrameμΌλ΅ λ³€ν™
            new_df = pd.DataFrame(new_dataset)
            
            # μƒλ΅μ΄ λ°μ΄ν„°μ…‹μ„ CSV νμΌλ΅ μ €μ¥
            new_df.to_csv("μ €μ¥ν•κ³  μ‹¶μ€ κ²½λ΅\\μ΄λ¦„.csv", index=False, encoding='utf-8')
            ```
            
        - μμ‹
            
            ![preprocess.png](Smart_nurse_Chatbot/preprocess.png)
            

### d. LLM ν•™μµ λ°μ΄ν„°μ…‹ μ μ‘

- μ „μ²λ¦¬ν• λ°μ΄ν„°μ…‹μ„ LLM ν•™μµμ— ν•„μ”ν• jsonl ν•νƒλ΅ λ³€ν™
    - κ°„νΈκΈ°λ΅ λ°μ΄ν„° μ»¬λΌμ—μ„ λ³‘λ…(disease name) μ¶”μ¶
        - λ³‘λ…μ„ μ¶”μ¶ ν•  μ μ—†λ” λ°μ΄ν„°λ” μ κ±°
    - μ½”λ“
        
        ```python
        import pandas as pd
        from langchain.chat_models import ChatOpenAI
        from langchain.chat_models import AzureChatOpenAI
        from langchain.prompts import ChatPromptTemplate
        
        # Azure OpenAIλ¥Ό μ‚¬μ©ν•λ” κ°μ²΄ μƒμ„±
        chat = AzureChatOpenAI(
            deployment_name='λ¨λΈ',
            model_name='gpt-35-turbo',
        )
        
        # λ³‘λ… μ¶”μ¶ ν”„λ΅¬ν”„νΈ ν…ν”λ¦Ώ μƒμ„±
        prompt = ChatPromptTemplate.from_messages(
            [
                (
                    "system",
                    
                    """ λ‹Ήμ‹ μ€ κ°„νΈκΈ°λ΅ μ‘μ„±μ§€λ¥Ό μ‘μ„±ν•΄μ£Όλ” μ „λ¬Έκ°€μ…λ‹λ‹¤. λ‹¤μμ μλ£κΈ°λ΅μ„ λ¶„μ„ν•κ³  μμ‹λ¥Ό μ°Έκ³ ν•μ—¬ λ€ν‘μ μΈ λ³‘λ… ν•λ‚λ§ κΈ°μ…ν•μ„Έμ”.
                    μμ‹ : λΉ„ν¨κ³Όμ  νΈν΅ μ–‘μƒ, λΉ„ν¨κ³Όμ  κΈ°λ„μ²­κ²°, κ°€μ¤κµν™ μ¥μ• , λ‚™μƒμ μ„ν—, λ¶μ•μ •ν• νμ••μ μ„ν—, κ·Όμ΅μ κΈ΄μ¥,  μ¶©μμ—ΌμΌλ΅ μΈν• λ³µν†µ,  μ™Έμƒμ„± μ§€μ£Όλ§‰ν•, μ¶ν,  λ‹Ήλ‡¨λ³‘,  λ¬΄λ¦κ΄€μ μ¦ ν‡΄ν–‰μ„± κ΄€μ μ—Ό,  ν†µμ¦,  μ•μ°½,  μλ°μ  ν™κΈ°μ¥μ• ,  κΈ‰μ„±ν†µμ¦,  κ³ μ²΄μ¨,  λ¶„λ§ ν†µμ¦ 
                    """,
                ),
                ("human", "{medical_record}"),
            ]
        )
        
        # ν”„λ΅¬ν”„νΈμ™€ μ±„ν… λ¨λΈ κ²°ν•©
        chain = prompt | chat  
        # CSV νμΌμ—μ„ λ°μ΄ν„° λ¶λ¬μ¤κΈ°
        pd.read_csv("λ¬Έμ¥ μμ •ν• νμΌ κ²½λ΅", encoding="utf-8")
        # μƒλ΅μ΄ λ°μ΄ν„°μ…‹
        new_dataset = []
        
        # κ° ν–‰ μ²λ¦¬
        for index, row in df.iterrows():
            response = chain.invoke({"medical_record": row['input']})
            new_dataset.append({'input': row['input'], 'disease name': response})
            print(response)
            
        
        # μƒλ΅μ΄ λ°μ΄ν„°μ…‹μ„ DataFrameμΌλ΅ λ³€ν™
        new_df = pd.DataFrame(new_dataset)
        
        # μ •μ  ν•¨μμ •μ
        def cleaning(text):
            replacements = {
                r'content=': '',
                r'.*λ³‘λ…': 'λ³‘λ…',
                r'λ³‘λ… : ' : 'λ³‘λ…: ',
                r'A:' : 'λ³‘λ…:',
                r'μ£Όμ§„λ‹¨λ…': 'λ³‘λ…',
                r'μ§„λ‹¨λ…' : 'λ³‘λ…',
        
            }
        
            for pattern, replacement in replacements.items():
                text = re.sub(pattern, replacement, text)
        
            return text
        
        def clean2(text):
          text = re.sub(r'λ³‘λ…: ', '', text)
          return text
        
        # λ°μ΄ν„°ν”„λ μ„μ— ν•¨μ μ μ©
        new_df['disease name'] = new_df['disease name'].apply(cleaning)
        new_df
        
        # μƒλ΅μ΄ λ°μ΄ν„°μ…‹μ„ CSV νμΌλ΅ μ €μ¥
        new_df.to_csv("μ €μ¥ν•κ³  μ‹¶μ€ κ²½λ΅\\μ΄λ¦„.csv", index=False, encoding='utf-8')
        ```
        
    - κ²°κ³Ό
        
        ![α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2023-12-14 α„‹α…©α„’α…® 2.16.34.png](Smart_nurse_Chatbot/sampledata1.png)
        
        ![α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2023-12-14 α„‹α…©α„’α…® 2.31.28.png](Smart_nurse_Chatbot/sampledata2.png)
        
    - jsonl ν•νƒλ΅ λ³€ν™
    - μμ‹
        
        ```json
        
        {"role": "user", "content": "**νΈν΅κ³¤λ€**μ— λ€ν• κ°„νΈκΈ°λ΅μ„ FOCUS DARν•μ‹μΌλ΅ μ‘μ„±ν•΄μ¤"}, {"role": "assistant", "content": "FOCUS:  λΉ„κ°•μΊλ‰ΌλΌλ¥Ό ν†µν• μ‚°μ†μ”λ²• D: [μ£Όκ΄€μ  μλ£] \"μ¨μ‰¬κΈ°κ°€ λ‹µλ‹µν•΄μ”.\"    [κ°κ΄€μ  μλ£] νΈν΅κ³¤λ€κ³Ό μ „μ‹ μ‡ μ•½ μ¦μƒμΌλ΅ μΈν•΄ μν™κΈ°λ‚΄κ³Ό μ…μ›μΉλ£λ¥Ό μ”μ²­ν•¨. μ•μ λ¶€μ  λ§μ΄μ‚°μ†ν¬ν™”λ„ μΈ΅μ • κ²°κ³Ό Sp02. A: - μ£ΌμΉμκ°€ cannulaλ΅ 3L/min λ§μ΄μ‚°μ†ν¬ν™”λ„ μΈ΅μ • κ²°κ³Όλ¥Ό κ³„μ†ν•΄μ„ λ¨λ‹ν„°λ§ν•λ©°, νΈν΅κ³¤λ€μΌλ΅ Semi-Fowler\\'s positionμ„ μ μ©ν•μ—¬ λ€μƒμμ μ „λ°μ μΈ μƒνƒλ¥Ό ν™•μΈν•¨.    - λ€μƒμμ ν™λ ¥μ§•ν›„ λ° νΈν΅μμ™€ μ‚°μ† μ‚¬μ©λ‰μΌλ΅ ν™”μ¬ λ°μƒ μ„ν—μ„±μ΄ μμ–΄ λΉ„κ°•μΊλ‰ΌλΌλ¥Ό ν†µν• μ‚°μ†μ”λ²•μ„ μ‹ν–‰ν•κ³ , ν”Όλ¶€ μ†μƒμ μ„ν—μ„±μ— λ€ν•΄ μ μν•¨. R: νμ•• 100/70mmHg, λ§¥λ°• 90ν/λ¶„, νΈν΅μ 20ν/λ¶„, μ²΄μ¨ 37.0ΛC, Sp02 μΈ΅μ • κ²°κ³Ό νΈν΅κ³¤λ€μ΄ μ™„ν™”λμ—μΌλ©°, λ€μƒμκ°€ κµμ΅ λ‚΄μ©μ„ μ΄ν•΄ν•κ³  νΈμ•ν•λ‹¤κ³  ν•¨."}]}
        {"role": "user", "content": "**μ„μ¥κ΄€ μ”λ¥μ¦**μ— λ€ν• κ°„νΈκΈ°λ΅μ„ NarrativeNoteν•μ‹μΌλ΅ μ‘μ„±ν•΄μ¤"}, {"role": "assistant", "content": "NarrativeNote: λ€μƒμμ μ„κ΄€μμ–‘μ„ ν™•μΈν• κ²°κ³Ό 23mLμ μ”λ¥λ‰μ΄ μμ—μµλ‹λ‹¤. μ΄μ— λ€ν•΄ 1200ccμ μ•΅μ²΄λ¥Ό L-Tube λ°©λ²•μ„ ν†µν•΄ μ£Όμ…ν•μ€μΌλ©°, gtt/minμ„ μ„¤μ •ν•μ€μµλ‹λ‹¤. λ€μƒμλ” λ³µλ¶€ν½λ§ μ¦μƒμ΄ μ—†μ—κ³ , λ°μΆμ„λ¥Ό μ·¨ν•λ„λ΅ κµμ΅ν•μ€μµλ‹λ‹¤."}]}
        {"role": "user", "content": "**μƒμ„Έλ¶λ…μ λ°”μ΄λ¬μ¤μ— μν• λΉ„ν¨κ³Όμ  νΈν΅ μ–‘μƒ**μ— λ€ν• κ°„νΈκΈ°λ΅μ„ NANDA DARν•μ‹μΌλ΅ μ‘μ„±ν•΄μ¤"}, {"role": "assistant", "content": "Domain: ν™λ™/ν΄μ‹  [Class] μ‹¬νκ΄€/νΈν΅κΈ°κ³„ λ°μ‘  [Diagnosis] λΉ„ν¨κ³Όμ  νΈν΅ μ–‘μƒ  [Collecting Data] ν™μλ” \"μ¨μ‰¬κΈ°κ°€ λ¶νΈν•΄μ”\" λΌκ³  μ–ΈκΈ‰ν•μ€μΌλ©°, μ§„λ‹¨λ…μ€ μƒμ„Έλ¶λ…μ λ°”μ΄λ¬μ¤μ΄κ³ , x-ray κ²°κ³Όλ” rightμ΄λ©° 110/70 RR25 Spo2 μ•μƒ‰κ±°λ¦¬λ” \"sutum\"μ΄ λ°κ²¬λμ—λ‹¤.  [Goal] - λ‹¨κΈ°λ©ν‘: λ€μƒμλ” μ •μƒμ μΈ νΈν΅μ–‘μƒμ„ κ°€μ§€κ² λλ‹¤. - μ¥κΈ°λ©ν‘: λ€μƒμλ” νΈν΅ν•κΈ° νΈμ•ν•κ² λλ‹¤.  [Plan] - νΈν΅μμ™€ λ¦¬λ“¬μ„ μΈ΅μ •ν•κ³ , ν•„μ”μ‹ μ΅°μ •ν•λ‹¤. - ν¨μ¨μ μΈ κΈ°μΉ¨μ„ ν•λ„λ΅ λ€μƒμλ¥Ό κ²©λ ¤ν•λ‹¤. - λ€μƒμλ¥Ό μΏ μ…μΌλ΅ μ§€μ§€ν•μ—¬ νΈν΅κΈ°κ³„ μ‚¬μ©μ΄ ν•„μ”ν•λ‹¤λ©΄ μ‚¬μ©ν•λ‹¤.  [Interventions] - νΈν΅μμ™€ λ¦¬λ“¬μ„ μΈ΅μ •ν•μ€κ³ , 11/15 09:00μ— λ³€κ²½ν•μ€λ‹¤. - ν™μλ¶„κ»μ„ νΈν΅κΈ° κ΄€λ¦¬λ¥Ό μ„ν•΄ λ³€κ²½ν•΄μ£Όμ—λ‹¤. - λ€μƒμκ°€ ν¨μ¨μ μΌλ΅ κΈ°μΉ¨ν•  μ μλ„λ΅ κ²©λ ¤ν•μ€λ‹¤. - λ€μƒμλ¥Ό ν¨μ¨μ μΌλ΅ κ²©λ ¤ν•μ—¬ λ°°μ¶μ΄ μ›ν™ν•λ„λ΅ λ„μ™”λ‹¤. - λ€μƒμλ¥Ό μΏ μ…μΌλ΅ μ§€μ§€ν•μ—¬ νΈν΅κΈ°κ³„ μ‚¬μ©μ΄ ν•„μ”ν•λ‹¤λ©΄ μ‚¬μ©ν•μ€λ‹¤.  [Evaluation] - λ‹¨κΈ°λ©ν‘: λ€μƒμλ” μ •μƒμ μΈ νΈν΅μ–‘μƒμ„ (λ―Έλ‹¬μ„±) 11/16 09:00 ν™μλ¶„κ»μ„ μ „λ³΄λ‹¤λ” λ‚μ•„μ΅μ§€λ§ λ¶νΈν•¨μ„ νΈμ†ν•μ€λ‹¤. - μ¥κΈ°λ©ν‘: λ€μƒμλ” νΈν΅ν•κΈ° νΈμ•ν•λ‹¤κ³  νλ‹¨ν•  μ μ—†μΌλ©°, μ¶”ν›„ κ΄€μ°°μ΄ ν•„μ”ν•λ‹¤. (2022.11.15)"}]}
        {"role": "user", "content": "**μ§€μ£Όλ§‰ν• μ¶ν**μ— λ€ν• κ°„νΈκΈ°λ΅μ„ SOAPIEν•μ‹μΌλ΅ μ‘μ„±ν•΄μ¤"}, {"role": "assistant", "content": "S: \"ν™μκ°€ λ¨Ήμ„ λ•λ§λ‹¤ κ±Έλ ¤μ”\" O: μ§€μ£Όλ§‰ν• μ¶ν μ§„λ‹¨μΌλ΅ μ…μ›ν•μ—¬ μΉλ£ μ¤‘μ΄λ©° κΈ°μΉ¨μ΄ κ΄€μ°°λ©λ‹λ‹¤. A: -μ—°ν•κ³¤λ€μΌλ΅ κµ¬κ°•μ„­μ·¨ μ–΄λ ¤μ›€μ΄ μμ. P: semi-fowlerμ μμ„Έλ΅ μ·¨μΉ¨ μ‹ν‚¤κΈ°, ν•„μ”μ‹ κ²½μ¥ μμ–‘μ•΅ μ κ³µ λ° ν΅μΈ μ‹ ν¬μ—¬ν•κΈ°. I: -κ²½μ¥ μμ–‘μ•΅ μν–‰ν•¨. -κ²½μ¥ μμ–‘ ν¬μ—¬λ¥Ό μ„ν•΄ ν΅μΈν•μ—¬ ν™•μΈν•¨. -L-tube μ‚½μ…ν•μ—¬ 200ml μ£Όμ…ν•¨. 30mlμ”© μ£Όμ…ν•¨. μΈ΅μ •ν•¨. -μ•‰μ•„μμ„ λ•μ κµμ΅μ„ μ‹ν–‰ν•¨. E: -L-tube μ‚½μ… ν›„ semi-fowlerμ μμ„Έλ¥Ό μ μ§€ν•¨."}]}
        ```
        
- μµμΆ…μ μΌλ΅ ν•™μµμ— μ‚¬μ©ν• λ°μ΄ν„°
    
    ![train_data.png](Smart_nurse_Chatbot/train_data.png)
    

# 3. Model : LLM(GPT-3.5 Turbo) Fine Tuning

### a. GPT API : Microsoft Azure Open AI

- GPT API λ¶λ¬μ¤κΈ° μ½”λ“
    
    ```python
    !pip install openai
    from openai import OpenAI
    
    #api λ¶λ¬μ¤κΈ°
    client = OpenAI(api_key=" ")
    prompt = [{"role": "system", "content": "system"}]
    
    def chat(text):
      user_input = {"role": "user", "content": text}
      prompt.append(user_input)
      answer = client.chat.completions.create(
          model="gpt-3.5-turbo",
          prompt=prompt,
          temperature=1,
          top_p=0.9) # λ‹¤λ¥Έ parameter μ¶”κ°€
    
      answ = answer.to_dict_recursive()
      bot_answ = answer['choices'][0]['meassage']['content']
      bot_resp = {"role" : "assistant", "content" : bot_answ}
      prompt.append(bot_resp)
      return bot_answ
    
    print(chat("λ‚™μƒ κ³ μ„ν—κµ° κ°„νΈκΈ°λ΅ μ¨μ¤."))
    ```
    
    β†’ κΈ°μ—…μ—μ„ μ κ³µν• Azureλ¥Ό ν†µν•΄μ„ OpenAI APIλ¥Ό μ‚¬μ©ν•  μμ •
    

### b. GPT Fine-tuning

- λΉμ¶ λ³‘λ…λ³„ κ° μ–‘μ‹μ μ΄μƒμ μΈ μƒν” λ°μ΄ν„°μ…‹ μ μ‘
    - ChatGPT ν™μ©
        
        ![generation.png](Smart_nurse_Chatbot/generation.png)
        
        - ChatGPTμ— λ€ν• μ¤λ¥ μ²΄ν¬
        (e.g. ν†µμ¦ν™μμ κ°„νΈκΈ°λ΅μ„ μ‘μ„±ν•λΌλ” instructμ— β€ν•ν’ ν†µμ¦ ν™μβ€™ μμ‹λ¥Ό μƒμ„±)
    - μtl
- GPT Fine-tuning
    - Instruction tuning
        
        ```python
        system_instruction =
        """
        λ„λ” λ€ν•™λ³‘μ› κ°„νΈμ‚¬μ•Ό. λ‹¤μμ μ§€μΉ¨λ€λ΅ λΉ„ν¨κ³Όμ  νΈν΅ μ–‘μƒ ν™μμ κ°„νΈκΈ°λ΅μ„ κµ¬μ²΄μ μΌλ΅ μ‘μ„±ν•΄μ¤.
        
        1. NANDA, SOAPIE, Focus DAR λ“± κ°„νΈκΈ°λ΅ μ–‘μ‹μ— λ§κ² μ μ–΄μ£Όμ„Έμ”.
        2. μ£Όμ” μ¦μƒ λ° νΉμ„±, λ‹¨κΈ° λ° μ¥κΈ° λ©ν‘, κ°„νΈ μ¤‘μ¬, κ°„νΈ ν‰κ°€ ν•­λ©μ„ ν•„μ κΈ°μ¬ν•μ„Έμ”.
        3. μµλ€ν• κµ¬μ²΄μ μΌλ΅ μ‘μ„±ν•μ„Έμ”. μλ¥Ό λ“¤μ–΄ 'μ μ ν• νΈν΅ κΈ°λ²• κµμ΅'μ΄λ€ λ‹µλ³€ λ³΄λ‹¨ 'νΈν΅ μ΄λ™ κµμ΅: κΉκ³  μ²μ²ν μ¨μ‰¬κΈ°, λ³µμ‹νΈν΅λ²• κµμ΅'μ΄ μΆ‹μµλ‹λ‹¤.
        4. μ •ν™•ν• μμΉλ¥Ό κΈ°λ΅ν•μ„Έμ”. μλ¥Ό λ“¤μ–΄ 'ν™μμ νΈν΅μκ°€ 24μ‹κ°„ μ΄λ‚΄μ— λ¶„λ‹Ή 12~20νλ΅ μ •μƒ λ²”μ„ λ‚΄λ΅ κ°μ†'
        5. μ •ν™•ν•κ³  κ°„κ²°ν• λ§ν¬λ¥Ό μ‚¬μ©ν•μ„Έμ”. ~μ…λ‹λ‹¤. ~μ—μ” κ°™μ€ λ¬Έμ¥μ‹ μ„μ μ€ ν”Όν•΄μ£Όμ„Έμ”.
        
        """
        ```
        
    - Prompt tuning
        
        ```python
        prompt_format = """"
        {"role": "system", "content": instruction"}, {"role": "user", "content": "Question"}, {"role": "assistant", "content": "Answer"}
        """
        prompt = [
            {"role": "system", "content": system_instruction}, {"role": "user", "content": "λΉ„ν¨κ³Όμ  νΈν΅ μ–‘μƒ ν™μμ κ°„νΈκΈ°λ΅ NANDA μ–‘μ‹μΌλ΅ μ‘μ„±ν•΄μ¤."}, {"role": "assistant", "content": "ν™μ μ •λ³΄:\n\nμ΄λ¦„: μ΄ν•΄μ¤€\nλ‚μ΄: 34μ„Έ\nμ„±λ³„: λ‚¨μ„±\n\nμ§„λ‹¨: λΉ„ν¨κ³Όμ  νΈν΅ μ–‘μƒ (NANDA-I #00032)\n\nμ£Όμ” μ¦μƒ λ° νΉμ„±:\n\n*νΈν΅μ μ¦κ°€ (λ¶„λ‹Ή 24ν)\n*νΈν΅κ³¤λ€ μ¦μƒ (μ–•κ³  λΉ λ¥Έ νΈν΅)\n*μ‚°μ†ν¬ν™”λ„ κ°μ† (92%)\n*ν™μμ μ£Όκ΄€μ  νΈν΅ λ¶νΈ ν‘ν„\n\nλ‹¨κΈ° λ©ν‘:\n\n*ν™μμ νΈν΅μκ°€ 24μ‹κ°„ μ΄λ‚΄μ— λ¶„λ‹Ή 12~20νλ΅ μ •μƒ λ²”μ„ λ‚΄λ΅ κ°μ†\n*μ‚°μ†ν¬ν™”λ„κ°€ 95% μ΄μƒμΌλ΅ μ μ§€\n\nμ¥κΈ° λ©ν‘:\n\n*ν™μκ°€ νΈν΅ κ³¤λ€μ„ νΈμ†ν•μ§€ μ•κ³ , μ‚°μ†ν¬ν™”λ„κ°€ μ§€μ†μ μΌλ΅ 95% μ΄μƒ μ μ§€\n*ν™μκ°€ νΈν΅μ— κ΄€λ ¨λ μκ°€ κ΄€λ¦¬ λ°©λ²•μ„ μ΄ν•΄ν•κ³  μ‹¤ν–‰\n\nκ°„νΈ κ³„ν λ° μ¤‘μ¬:\n\n*νΈν΅ μƒνƒ λ¨λ‹ν„°λ§: 2μ‹κ°„λ§λ‹¤ νΈν΅μ, μ‚°μ†ν¬ν™”λ„ μ²΄ν¬\n*μ‚°μ† μ”λ²•: μμ‚¬μ μ§€μ‹μ— λ”°λΌ μ‚°μ† κ³µκΈ‰ (ν•„μ” μ‹)\n*νΈν΅ μ΄λ™ κµμ΅: κΉκ³  μ²μ²ν μ¨μ‰¬κΈ°, λ³µμ‹νΈν΅λ²• κµμ΅\n*μ•μ„ μ κ³µ: νΈμ•ν• μμ„Έ μ μ§€, μ¤νΈλ μ¤ κ°μ† λ°©λ²• μ•λ‚΄\n*κµμ΅ λ° μƒλ‹΄: νΈν΅κ³¤λ€μ μ›μΈκ³Ό κ΄€λ¦¬ λ°©λ²• μ„¤λ…\n\nκ°„νΈ ν‰κ°€:\n*νΈν΅ μƒνƒ: νΈν΅μ λ° μ‚°μ†ν¬ν™”λ„ λ³€ν™” λ¨λ‹ν„°λ§\n*ν™μμ μκ°€ κ΄€λ¦¬ λ¥λ ¥: νΈν΅ μ΄λ™ μ‹¤μ‹ μ—¬λ¶€ λ° ν¨κ³Ό ν‰κ°€\n*κµμ΅ ν¨κ³Ό: ν™μμ μ΄ν•΄λ„ λ° λ°μ‘ κ΄€μ°°"},
            {"role": "system", "content": system_instruction}, {"role": "user", "content": "κ³ μ²΄μ¨ ν™μμ κ°„νΈκΈ°λ΅μ„ SOAPIE μ–‘μ‹μΌλ΅ μ‘μ„±ν•΄μ¤."}, {"role": "assistant", "content":"ν™μ μ •λ³΄: \n μ΄λ¦„: μ •μν„\n λ‚μ΄: 32μ„Έ\n μ„±λ³„: μ—¬μ„±\n\nSOAPIE κΈ°λ΅:\n\nS: μ£Όκ΄€μ  λ°μ΄ν„° (Subjective):\n ν™μλ” μµκ·Όμ— μ²΄μ¨μ΄ κ³„μ†ν•΄μ„ λ†’μ•„μ§€λ©° "'κ³„μ† λ•€μ΄ λ‚κ³  λΈμ΄ μ‘¤μ…”'"λΌκ³  μ–ΈκΈ‰ν•¨.\n\nO: κ°κ΄€μ  λ°μ΄ν„° (Objective): \nμ²΄μ¨μ΄ 38.8Β°Cλ΅ μƒμΉ\nν”Όλ¶€λ” λ¨κ±°μ› λ³΄μ΄κ³  λ•€μ΄ λ§μ΄ λ‚κ³  μμ. \nμ‹μ• κ°μ† λ° μ²΄μ¤‘ κ°μ†λ„ κ΄€μ°°λ¨.\n\nA: ν‰κ°€ (Assessment): \nν™μλ” κ³ μ²΄μ¨ μƒνƒμ— μμ\nκ³ μ²΄μ¨μ΄ μ‹μ• κ°μ†μ™€ μ²΄μ¤‘ κ°μ†λ¥Ό μ λ°ν•¨.\n\nP: κ³„ν (Plan):  \n1. μ μ ν• μλ¶„ κ³µκΈ‰κ³Ό λƒ‰κ°μ„ μ„ν• κ°„νΈ μ¤‘μ¬   \n2. μ²΄μ¨ μ΅°μ μ„ μ„ν• μμ‚¬μ™€μ ν‘λ ¥   \n3. μμ–‘ μƒνƒ ν‰κ°€ λ° μμ–‘μ  ν¬μ—¬ κ²€ν† .\n\nI: κ°„νΈ μ¤‘μ¬ (Intervention): \n1. μ μ ν• μλ¶„ κ³µκΈ‰ λ° λƒ‰κ°μ„ μ„ν•΄ μΏ¨λ§ ν…ν¬λ‹‰ μ μ©   \n2. μμ‚¬μ μ§€μ‹μ— λ”°λΌ μ²΄μ¨ μ΅°μ μ„ μ„ν• μΉλ£ μ‹ν–‰   \n3. μμ–‘μ‚¬μ™€ ν‘λ ¥ν•μ—¬ ν™μμ μμ–‘ μƒνƒλ¥Ό ν‰κ°€ν•κ³  ν•„μ” μ‹ μμ–‘μ  ν¬μ—¬.\n\nE: ν‰κ°€ (Evaluation): \n1. μΏ¨λ§ ν…ν¬λ‹‰κ³Ό μλ¶„ κ³µκΈ‰μΌλ΅ μ²΄μ¨μ΄ μ•μ •λκ³  λ•€μ΄ κ°μ†ν•¨  \n 2. μμ‚¬μ μΉλ£λ΅ μ²΄μ¨μ΄ μ •μƒ λ²”μ„λ΅ νλ³µλ¨   \n3. μμ–‘ μƒνƒκ°€ ν–¥μƒλκ³  μ²΄μ¤‘μ΄ μ¦κ°€ν•¨."},
            {"role": "system", "content": system_instruction}, {"role": "user", "content": "λ¶„λ§ν†µμ¦ ν™μμ κ°„νΈκΈ°λ΅μ„ Focus DAR μ–‘μ‹μΌλ΅ μ‘μ„±ν•΄μ¤."}, {"role": "assistant", "content":"ν™μ μ •λ³΄:\nμ΄λ¦„: κΉ€μ§€μ€  \nλ‚μ΄: 28μ„Έ  \nμ„±λ³„: μ—¬μ„±  \n\nFocus: λ¶„λ§ ν†µμ¦ κ΄€λ¦¬  \n\nData:\n ν™μλ” ν„μ¬ 38μ£Όμ— μ…μ„±ν• μ„μ‹ λ¶€λ΅, μμ—°λ¶„λ§μ„ ν†µν• λ¶„λ§μ„ κ³„νν•κ³  μμ.\n ν™μλ” 1μ‹κ°„ κ°„κ²©μΌλ΅ μλ°μ μΌλ΅ μ‹μ‘λ μκ¶ μμ¶•μ΄ μ§„ν–‰ μ¤‘μ΄λ©°, μμ¶• κ°„κ²©μ΄ μ μ°¨ κ°μ†ν•κ³  μμ.\n λ¶„λ§ λ„μ¤‘μ— ν†µμ¦μ΄ κ°•ν•κ² λκ»΄μ§€λ©°, μκ·Ήμ„ λ°›μ„ λ•μ™€ μμ¶• μ¤‘μ— κ°€μ¥ κ°•ν• ν†µμ¦μ„ λλΌκ³  μμ.\n ν†µμ¦μ κ°•λ„λ” Visual Analog Scale (VAS)λ΅ 8μ μΌλ΅ ν‰κ°€λλ©°, ν†µμ¦κ³Ό ν•¨κ» νΈν΅ κ³¤λ€ λ° μ•μ λ¶€μ  λ»ν•λ” λλ‚μ„ νΈμ†ν•¨.\n μ‚°λ¨λ” μμ—°λ¶„λ§μ„ μ›ν•λ©°, μ§„ν†µμ μ— λ€ν• κ°μ…μ„ μµμ†ν™”ν•κ³ μ ν•¨.\n\nAction:\n1. κ°„νΈμ§„μ€ μ‚°λ¨μ ν†µμ¦ κ²½ν—μ„ μ •ν™•ν κΈ°λ΅ν•κ³ , μμ—°λ¶„λ§μ„ μ„ν• ν†µμ¦ κ΄€λ¦¬ κ³„ν μλ¦½.\n2. ν†µμ¦μ κ°•λ„ λ° λλ‚μ„ μ •ν™•ν κΈ°λ΅ν•κ³ , μμ¶•κ³Ό ν†µμ¦ κ°„μ κ΄€κ³„λ¥Ό λ¶„μ„ν•μ—¬ μµμ μ κ΄€λ¦¬ μ „λµμ„ μ°Ύμ.\n3. νΈν΅ λ° μ•μ •μ μΈ μμ„Έ μ μ§€μ— λ€ν• κµμ΅μ„ μ‹¤μ‹ν•μ—¬ μ‚°λ¨κ°€ ν¨κ³Όμ μΈ ν†µμ¦ κ΄€λ¦¬λ¥Ό μ„ν•΄ μ μ ν• λ°©λ²•μ„ ν™μ©ν•λ„λ΅ μ§€μ›.\n4. μ‚°λ¨μ ν†µμ¦μ— λ€ν• μ΄ν•΄λ„λ¥Ό λ†’μ΄κ³ , μ‚°λ¨μ™€ λ™λ°μμ—κ² ν‘λ ¥μ μΈ ν†µμ¦ κ΄€λ¦¬μ— λ€ν• μ§€μΉ¨μ„ μ κ³µ.\n5. ν•„μ”ν• κ²½μ° μμ‚¬μ™€ ν‘λ ¥ν•μ—¬ μ¶”κ°€μ μΈ ν†µμ¦ κ΄€λ¦¬ μµμ…μ„ κ²€ν† ν•κ³ , λ¶„λ§ μ§„ν–‰ μƒν™©μ— λ”°λΌ κ΄€λ¦¬ κ³„νμ„ μ΅°μ .\n\nResponse:\n μ‚°λ¨λ” νΈν΅ λ° μ•μ •μ μΈ μμ„Έ μ μ§€λ¥Ό ν†µν•΄ ν†µμ¦μ„ μΌλ¶€ μ™„ν™”ν•κ³ , μ μ ν• λ°©λ²•μ„ ν™μ©ν•μ—¬ ν†µμ¦μ— λ€μ²ν•¨.\n ν†µμ¦μ κ°•λ„μ™€ λλ‚μ„ μ •ν™•ν κΈ°λ΅ν•μ—¬ κ°„νΈμ§„μ€ ν¨κ³Όμ μΈ ν†µμ¦ κ΄€λ¦¬ κ³„νμ„ μλ¦½ν•κ³  μ΅°μ ν•¨.\n μ‚°λ¨λ” μ§„ν†µμ μ— λ€ν• κ°μ…μ„ μµμ†ν™”ν•κ³ , μμ—°λ¶„λ§μ κ²½ν—μ„ μ¤‘μ”μ‹ν•μ—¬ ν†µμ¦μ„ λ”μ± κ΄€λ¦¬ κ°€λ¥ν• μμ¤€μΌλ΅ μ μ§€ν•¨.\n κ°„νΈμ§„μ κµμ΅κ³Ό μ§€μ›μ„ ν†µν•΄ μ‚°λ¨μ™€ λ™λ°μλ” ν†µμ¦ κ΄€λ¦¬μ— λ€ν• μ΄ν•΄λ„κ°€ ν–¥μƒλμ–΄ ν‘λ ¥μ μΌλ΅ μ°Έμ—¬ν•¨.\n λ¶„λ§ λ„μ¤‘μ—λ” μ‚°λ¨μ ν†µμ¦ κ΄€λ¦¬λ¥Ό κ³„μ† λ¨λ‹ν„°λ§ν•κ³ , ν•„μ”μ— λ”°λΌ μμ‚¬μ™€ ν‘λ ¥ν•μ—¬ μ¶”κ°€μ μΈ μ΅°μΉλ¥Ό μ·¨ν•¨."},
            {"role": "system", "content": system_instruction}, {"role": "user", "content": "κ°€μ¤ κµν™ μ¥μ•  ν™μμ κ°„νΈκΈ°λ΅ Narrative Note μ–‘μ‹μΌλ΅ μ‘μ„±ν•΄μ¤."}, {"role": "assistant", "content": "ν™μ μ •λ³΄: \n μ΄λ¦„: μ΄μ² μ\n λ‚μ΄: 65μ„Έ\n μ„±λ³„: λ‚¨μ„±\n\nν™μ μ΄μ² μ μ”¨λ” λ¶μ•μ •ν• νμ••μΌλ΅ μ…μ›ν•μ€μ. μ…μ› λ‹Ήμ‹ νμ••μ€ 160/100 mmHgλ΅ μΈ΅μ •λμ—μΌλ©°, κ³Όκ±°λ ¥μΌλ΅ κ³ νμ•• λ° λ‹Ήλ‡¨λ³‘μ΄ μμ. ν™μλ” ν„κΈ°μ¦κ³Ό λ‘ν†µμ„ νΈμ†ν•¨. μ¶”κ°€μ μΌλ΅ ν™μλ” μµκ·Ό λ‡ μ£Όκ°„ μ•½λ¬Ό λ³µμ©μ„ μμ£Ό μμ–΄λ²„λ¦°λ‹¤κ³  λ³΄κ³ ν•¨.\n\nμ¤λ μ•„μΉ¨ νμ•• μΈ΅μ • κ²°κ³Όλ” 155/95 mmHgμ€μΌλ©°, μ¤μ „ μ¤‘μ— μΌμ‹μ μΌλ΅ 145/90 mmHgλ΅ κ°μ†ν•λ” κ²½ν–¥μ„ λ³΄μ„. ν™μλ” λ¶κ·μΉ™μ μΈ νμ•• λ³€ν™”μ— λ€ν•΄ μ°λ ¤λ¥Ό ν‘ν„ν•¨. ν™μμ νμ•• λ³€λ™κ³Ό κ΄€λ ¨ν•μ—¬ μƒν™ μµκ΄€, μ‹μ΄, μ•½λ¬Ό λ³µμ© ν¨ν„΄ λ“±μ„ λ©΄λ°€ν ν‰κ°€ν•¨.\n\nκ°„νΈ μ¤‘μ¬λ΅λ” νμ•• λ¨λ‹ν„°λ§μ„ λ§¤ 4μ‹κ°„λ§λ‹¤ μ‹¤μ‹ν•κ³ , μμ‚¬ μ§€μ‹μ— λ”°λΌ νμ•• μ΅°μ  μ•½λ¬Όμ„ ν¬μ—¬ν•¨. ν™μμ—κ² μ•½λ¬Ό λ³µμ© μΌμ •μ„ κ΄€λ¦¬ν•  μ μλ” λ°©λ²•μ„ μ•λ‚΄ν•κ³ , μ €μ—Όμ‹ μ‹λ‹¨κ³Ό κ·μΉ™μ μΈ μ΄λ™μ μ¤‘μ”μ„±μ— λ€ν•΄ κµμ΅ν•¨.\n\nμ¤ν›„ νμ•• μΈ΅μ • κ²°κ³Όλ” 150/92 mmHgλ΅ λ‹¤μ† μ•μ •λ κ²½ν–¥μ„ λ³΄μ„. ν™μλ” μ κ³µλ κµμ΅ λ‚΄μ©μ— λ€ν•΄ κΈμ •μ μΈ λ°μ‘μ„ λ³΄μ΄λ©°, μ•½λ¬Ό λ³µμ©κ³Ό μƒν™ μµκ΄€ κ°μ„ μ— λ€ν• μμ§€λ¥Ό ν‘ν„ν•¨. ν–¥ν›„ κ³„νμΌλ΅λ” μ§€μ†μ μΈ νμ•• λ¨λ‹ν„°λ§, μ•½λ¬Ό κ΄€λ¦¬ λ° ν™μ κµμ΅μ„ μ΄μ–΄κ° μμ •μ„."}
            ]
        ```
        
    - μ½”λ“
        
        ```python
        import os
        from openai import AzureOpenAI
        import pandas as pd
        # API λ¶λ¬μ¤κΈ°
        client = AzureOpenAI(
            api_key = 'key',
            api_version = 'version',
            azure_endpoint = 'url'
        
        # prompt tuning model
        
        system_instruction = "You are an assistant who needs to help nurses who are overwhelmed with nursing records(ENR).\
         You are a nurse in a tertiary care hospital or university hospital. Please complete a detailed nursing record for a patient with ineffective respiration using the following instructions.\
         1. NANDA κΈ°λ΅μ–‘μ‹, SOAPIE( S: subject data, O: object data, A: assessment, P: plan, I: intervention, E: evalutaion), Focus DAR(Focus, Data, Action, Response) λ“±μ κΈ°λ΅ μ–‘μ‹μ— λ§μ¶°μ„ μ‘μ„± ν•μ„Έμ”.\
         2. μµλ€ν• κµ¬μ²΄μ μΌλ΅ μ‘μ„±ν•μ„Έμ”. μλ¥Ό λ“¤μ–΄ β€μ μ ν• νΈν΅ κΈ°λ²• κµμ΅β€μ΄λ€ λ‹µλ³€ λ³΄λ‹¨ β€νΈν΅ μ΄λ™ κµμ΅: κΉκ³  μ²μ²ν μ¨μ‰¬κΈ°, λ³µμ‹νΈν΅λ²• κµμ΅β€μ΄ μΆ‹μµλ‹λ‹¤.\
         3. κ°€λ¥ν• μ •ν™•ν• μμΉ λ°μ΄ν„°λ¥Ό μ‚¬μ©ν•μ„Έμ”. μλ¥Ό λ“¤μ–΄ β€ν™μμ νΈν΅μκ°€ 24μ‹κ°„ μ΄λ‚΄μ— λ¶„λ‹Ή 12~20νλ΅ μ •μƒ λ²”μ„ λ‚΄λ΅ κ°μ†β€™\
         4. μ •ν™•ν•κ³  κ°„κ²°ν• λ§ν¬λ¥Ό μ‚¬μ©ν•μ„Έμ”. -μ, -ν•¨, -μ„ κ³Ό κ°™μ€ μ–΄λ―Έλ¥Ό μ‚¬μ©ν•μ„Έμ”.\
         5. ν™μ μ •λ³΄(μ΄λ¦„, λ‚μ΄, μ„±λ³„) μ„ ν¬ν•¨ν•μ„Έμ”.\
         6. ν•μ„κµ¬μ΅°λ” μ«μ λ€μ‹  bullet ν•μ‹μ„ μ‚¬μ©ν•μ„Έμ”.\
         7. user κ°€ μ μ‹ν•λ” λ°μ΄ν„°κ°€ μμ„ λ•λ” κ·Έ λ°μ΄ν„°λ¥Ό μ‚¬μ©ν•μ—¬ μ‘μ„±ν•μ„Έμ”. "
        
        prompt = [
            {"role": "system", "content": system_instruction}, {"role": "user", "content": "λΉ„ν¨κ³Όμ  νΈν΅ μ–‘μƒ ν™μμ κ°„νΈκΈ°λ΅ NANDA μ–‘μ‹μΌλ΅ μ‘μ„±ν•΄μ¤."}, {"role": "assistant", "content": "ν™μ μ •λ³΄:\n\nμ΄λ¦„: μ΄ν•΄μ¤€\nλ‚μ΄: 34μ„Έ\nμ„±λ³„: λ‚¨μ„±\n\nμ§„λ‹¨: λΉ„ν¨κ³Όμ  νΈν΅ μ–‘μƒ (NANDA-I #00032)\n\nμ£Όμ” μ¦μƒ λ° νΉμ„±:\n\n*νΈν΅μ μ¦κ°€ (λ¶„λ‹Ή 24ν)\n*νΈν΅κ³¤λ€ μ¦μƒ (μ–•κ³  λΉ λ¥Έ νΈν΅)\n*μ‚°μ†ν¬ν™”λ„ κ°μ† (92%)\n*ν™μμ μ£Όκ΄€μ  νΈν΅ λ¶νΈ ν‘ν„\n\nλ‹¨κΈ° λ©ν‘:\n\n*ν™μμ νΈν΅μκ°€ 24μ‹κ°„ μ΄λ‚΄μ— λ¶„λ‹Ή 12~20νλ΅ μ •μƒ λ²”μ„ λ‚΄λ΅ κ°μ†\n*μ‚°μ†ν¬ν™”λ„κ°€ 95% μ΄μƒμΌλ΅ μ μ§€\n\nμ¥κΈ° λ©ν‘:\n\n*ν™μκ°€ νΈν΅ κ³¤λ€μ„ νΈμ†ν•μ§€ μ•κ³ , μ‚°μ†ν¬ν™”λ„κ°€ μ§€μ†μ μΌλ΅ 95% μ΄μƒ μ μ§€\n*ν™μκ°€ νΈν΅μ— κ΄€λ ¨λ μκ°€ κ΄€λ¦¬ λ°©λ²•μ„ μ΄ν•΄ν•κ³  μ‹¤ν–‰\n\nκ°„νΈ κ³„ν λ° μ¤‘μ¬:\n\n*νΈν΅ μƒνƒ λ¨λ‹ν„°λ§: 2μ‹κ°„λ§λ‹¤ νΈν΅μ, μ‚°μ†ν¬ν™”λ„ μ²΄ν¬\n*μ‚°μ† μ”λ²•: μμ‚¬μ μ§€μ‹μ— λ”°λΌ μ‚°μ† κ³µκΈ‰ (ν•„μ” μ‹)\n*νΈν΅ μ΄λ™ κµμ΅: κΉκ³  μ²μ²ν μ¨μ‰¬κΈ°, λ³µμ‹νΈν΅λ²• κµμ΅\n*μ•μ„ μ κ³µ: νΈμ•ν• μμ„Έ μ μ§€, μ¤νΈλ μ¤ κ°μ† λ°©λ²• μ•λ‚΄\n*κµμ΅ λ° μƒλ‹΄: νΈν΅κ³¤λ€μ μ›μΈκ³Ό κ΄€λ¦¬ λ°©λ²• μ„¤λ…\n\nκ°„νΈ ν‰κ°€:\n*νΈν΅ μƒνƒ: νΈν΅μ λ° μ‚°μ†ν¬ν™”λ„ λ³€ν™” λ¨λ‹ν„°λ§\n*ν™μμ μκ°€ κ΄€λ¦¬ λ¥λ ¥: νΈν΅ μ΄λ™ μ‹¤μ‹ μ—¬λ¶€ λ° ν¨κ³Ό ν‰κ°€\n*κµμ΅ ν¨κ³Ό: ν™μμ μ΄ν•΄λ„ λ° λ°μ‘ κ΄€μ°°"},
            {"role": "system", "content": system_instruction}, {"role": "user", "content": "κ³ μ²΄μ¨ ν™μμ κ°„νΈκΈ°λ΅μ„ SOAPIE μ–‘μ‹μΌλ΅ μ‘μ„±ν•΄μ¤."}, {"role": "assistant", "content":"ν™μ μ •λ³΄: \n μ΄λ¦„: μ •μν„\n λ‚μ΄: 32μ„Έ\n μ„±λ³„: μ—¬μ„±\n\nSOAPIE κΈ°λ΅:\n\nS: μ£Όκ΄€μ  λ°μ΄ν„° (Subjective):\n ν™μλ” μµκ·Όμ— μ²΄μ¨μ΄ κ³„μ†ν•΄μ„ λ†’μ•„μ§€λ©° "'κ³„μ† λ•€μ΄ λ‚κ³  λΈμ΄ μ‘¤μ…”'"λΌκ³  μ–ΈκΈ‰ν•¨.\n\nO: κ°κ΄€μ  λ°μ΄ν„° (Objective): \nμ²΄μ¨μ΄ 38.8Β°Cλ΅ μƒμΉ\nν”Όλ¶€λ” λ¨κ±°μ› λ³΄μ΄κ³  λ•€μ΄ λ§μ΄ λ‚κ³  μμ. \nμ‹μ• κ°μ† λ° μ²΄μ¤‘ κ°μ†λ„ κ΄€μ°°λ¨.\n\nA: ν‰κ°€ (Assessment): \nν™μλ” κ³ μ²΄μ¨ μƒνƒμ— μμ\nκ³ μ²΄μ¨μ΄ μ‹μ• κ°μ†μ™€ μ²΄μ¤‘ κ°μ†λ¥Ό μ λ°ν•¨.\n\nP: κ³„ν (Plan):  \n1. μ μ ν• μλ¶„ κ³µκΈ‰κ³Ό λƒ‰κ°μ„ μ„ν• κ°„νΈ μ¤‘μ¬   \n2. μ²΄μ¨ μ΅°μ μ„ μ„ν• μμ‚¬μ™€μ ν‘λ ¥   \n3. μμ–‘ μƒνƒ ν‰κ°€ λ° μμ–‘μ  ν¬μ—¬ κ²€ν† .\n\nI: κ°„νΈ μ¤‘μ¬ (Intervention): \n1. μ μ ν• μλ¶„ κ³µκΈ‰ λ° λƒ‰κ°μ„ μ„ν•΄ μΏ¨λ§ ν…ν¬λ‹‰ μ μ©   \n2. μμ‚¬μ μ§€μ‹μ— λ”°λΌ μ²΄μ¨ μ΅°μ μ„ μ„ν• μΉλ£ μ‹ν–‰   \n3. μμ–‘μ‚¬μ™€ ν‘λ ¥ν•μ—¬ ν™μμ μμ–‘ μƒνƒλ¥Ό ν‰κ°€ν•κ³  ν•„μ” μ‹ μμ–‘μ  ν¬μ—¬.\n\nE: ν‰κ°€ (Evaluation): \n1. μΏ¨λ§ ν…ν¬λ‹‰κ³Ό μλ¶„ κ³µκΈ‰μΌλ΅ μ²΄μ¨μ΄ μ•μ •λκ³  λ•€μ΄ κ°μ†ν•¨  \n 2. μμ‚¬μ μΉλ£λ΅ μ²΄μ¨μ΄ μ •μƒ λ²”μ„λ΅ νλ³µλ¨   \n3. μμ–‘ μƒνƒκ°€ ν–¥μƒλκ³  μ²΄μ¤‘μ΄ μ¦κ°€ν•¨."},
            {"role": "system", "content": system_instruction}, {"role": "user", "content": "λ¶„λ§ν†µμ¦ ν™μμ κ°„νΈκΈ°λ΅μ„ Focus DAR μ–‘μ‹μΌλ΅ μ‘μ„±ν•΄μ¤."}, {"role": "assistant", "content":"ν™μ μ •λ³΄:\nμ΄λ¦„: κΉ€μ§€μ€  \nλ‚μ΄: 28μ„Έ  \nμ„±λ³„: μ—¬μ„±  \n\nFocus: λ¶„λ§ ν†µμ¦ κ΄€λ¦¬  \n\nData:\n ν™μλ” ν„μ¬ 38μ£Όμ— μ…μ„±ν• μ„μ‹ λ¶€λ΅, μμ—°λ¶„λ§μ„ ν†µν• λ¶„λ§μ„ κ³„νν•κ³  μμ.\n ν™μλ” 1μ‹κ°„ κ°„κ²©μΌλ΅ μλ°μ μΌλ΅ μ‹μ‘λ μκ¶ μμ¶•μ΄ μ§„ν–‰ μ¤‘μ΄λ©°, μμ¶• κ°„κ²©μ΄ μ μ°¨ κ°μ†ν•κ³  μμ.\n λ¶„λ§ λ„μ¤‘μ— ν†µμ¦μ΄ κ°•ν•κ² λκ»΄μ§€λ©°, μκ·Ήμ„ λ°›μ„ λ•μ™€ μμ¶• μ¤‘μ— κ°€μ¥ κ°•ν• ν†µμ¦μ„ λλΌκ³  μμ.\n ν†µμ¦μ κ°•λ„λ” Visual Analog Scale (VAS)λ΅ 8μ μΌλ΅ ν‰κ°€λλ©°, ν†µμ¦κ³Ό ν•¨κ» νΈν΅ κ³¤λ€ λ° μ•μ λ¶€μ  λ»ν•λ” λλ‚μ„ νΈμ†ν•¨.\n μ‚°λ¨λ” μμ—°λ¶„λ§μ„ μ›ν•λ©°, μ§„ν†µμ μ— λ€ν• κ°μ…μ„ μµμ†ν™”ν•κ³ μ ν•¨.\n\nAction:\n1. κ°„νΈμ§„μ€ μ‚°λ¨μ ν†µμ¦ κ²½ν—μ„ μ •ν™•ν κΈ°λ΅ν•κ³ , μμ—°λ¶„λ§μ„ μ„ν• ν†µμ¦ κ΄€λ¦¬ κ³„ν μλ¦½.\n2. ν†µμ¦μ κ°•λ„ λ° λλ‚μ„ μ •ν™•ν κΈ°λ΅ν•κ³ , μμ¶•κ³Ό ν†µμ¦ κ°„μ κ΄€κ³„λ¥Ό λ¶„μ„ν•μ—¬ μµμ μ κ΄€λ¦¬ μ „λµμ„ μ°Ύμ.\n3. νΈν΅ λ° μ•μ •μ μΈ μμ„Έ μ μ§€μ— λ€ν• κµμ΅μ„ μ‹¤μ‹ν•μ—¬ μ‚°λ¨κ°€ ν¨κ³Όμ μΈ ν†µμ¦ κ΄€λ¦¬λ¥Ό μ„ν•΄ μ μ ν• λ°©λ²•μ„ ν™μ©ν•λ„λ΅ μ§€μ›.\n4. μ‚°λ¨μ ν†µμ¦μ— λ€ν• μ΄ν•΄λ„λ¥Ό λ†’μ΄κ³ , μ‚°λ¨μ™€ λ™λ°μμ—κ² ν‘λ ¥μ μΈ ν†µμ¦ κ΄€λ¦¬μ— λ€ν• μ§€μΉ¨μ„ μ κ³µ.\n5. ν•„μ”ν• κ²½μ° μμ‚¬μ™€ ν‘λ ¥ν•μ—¬ μ¶”κ°€μ μΈ ν†µμ¦ κ΄€λ¦¬ μµμ…μ„ κ²€ν† ν•κ³ , λ¶„λ§ μ§„ν–‰ μƒν™©μ— λ”°λΌ κ΄€λ¦¬ κ³„νμ„ μ΅°μ .\n\nResponse:\n μ‚°λ¨λ” νΈν΅ λ° μ•μ •μ μΈ μμ„Έ μ μ§€λ¥Ό ν†µν•΄ ν†µμ¦μ„ μΌλ¶€ μ™„ν™”ν•κ³ , μ μ ν• λ°©λ²•μ„ ν™μ©ν•μ—¬ ν†µμ¦μ— λ€μ²ν•¨.\n ν†µμ¦μ κ°•λ„μ™€ λλ‚μ„ μ •ν™•ν κΈ°λ΅ν•μ—¬ κ°„νΈμ§„μ€ ν¨κ³Όμ μΈ ν†µμ¦ κ΄€λ¦¬ κ³„νμ„ μλ¦½ν•κ³  μ΅°μ ν•¨.\n μ‚°λ¨λ” μ§„ν†µμ μ— λ€ν• κ°μ…μ„ μµμ†ν™”ν•κ³ , μμ—°λ¶„λ§μ κ²½ν—μ„ μ¤‘μ”μ‹ν•μ—¬ ν†µμ¦μ„ λ”μ± κ΄€λ¦¬ κ°€λ¥ν• μμ¤€μΌλ΅ μ μ§€ν•¨.\n κ°„νΈμ§„μ κµμ΅κ³Ό μ§€μ›μ„ ν†µν•΄ μ‚°λ¨μ™€ λ™λ°μλ” ν†µμ¦ κ΄€λ¦¬μ— λ€ν• μ΄ν•΄λ„κ°€ ν–¥μƒλμ–΄ ν‘λ ¥μ μΌλ΅ μ°Έμ—¬ν•¨.\n λ¶„λ§ λ„μ¤‘μ—λ” μ‚°λ¨μ ν†µμ¦ κ΄€λ¦¬λ¥Ό κ³„μ† λ¨λ‹ν„°λ§ν•κ³ , ν•„μ”μ— λ”°λΌ μμ‚¬μ™€ ν‘λ ¥ν•μ—¬ μ¶”κ°€μ μΈ μ΅°μΉλ¥Ό μ·¨ν•¨."},
            {"role": "system", "content": system_instruction}, {"role": "user", "content": "κ°€μ¤ κµν™ μ¥μ•  ν™μμ κ°„νΈκΈ°λ΅ Narrative Note μ–‘μ‹μΌλ΅ μ‘μ„±ν•΄μ¤."}, {"role": "assistant", "content": "ν™μ μ •λ³΄: \n μ΄λ¦„: μ΄μ² μ\n λ‚μ΄: 65μ„Έ\n μ„±λ³„: λ‚¨μ„±\n\nν™μ μ΄μ² μ μ”¨λ” λ¶μ•μ •ν• νμ••μΌλ΅ μ…μ›ν•μ€μ. μ…μ› λ‹Ήμ‹ νμ••μ€ 160/100 mmHgλ΅ μΈ΅μ •λμ—μΌλ©°, κ³Όκ±°λ ¥μΌλ΅ κ³ νμ•• λ° λ‹Ήλ‡¨λ³‘μ΄ μμ. ν™μλ” ν„κΈ°μ¦κ³Ό λ‘ν†µμ„ νΈμ†ν•¨. μ¶”κ°€μ μΌλ΅ ν™μλ” μµκ·Ό λ‡ μ£Όκ°„ μ•½λ¬Ό λ³µμ©μ„ μμ£Ό μμ–΄λ²„λ¦°λ‹¤κ³  λ³΄κ³ ν•¨.\n\nμ¤λ μ•„μΉ¨ νμ•• μΈ΅μ • κ²°κ³Όλ” 155/95 mmHgμ€μΌλ©°, μ¤μ „ μ¤‘μ— μΌμ‹μ μΌλ΅ 145/90 mmHgλ΅ κ°μ†ν•λ” κ²½ν–¥μ„ λ³΄μ„. ν™μλ” λ¶κ·μΉ™μ μΈ νμ•• λ³€ν™”μ— λ€ν•΄ μ°λ ¤λ¥Ό ν‘ν„ν•¨. ν™μμ νμ•• λ³€λ™κ³Ό κ΄€λ ¨ν•μ—¬ μƒν™ μµκ΄€, μ‹μ΄, μ•½λ¬Ό λ³µμ© ν¨ν„΄ λ“±μ„ λ©΄λ°€ν ν‰κ°€ν•¨.\n\nκ°„νΈ μ¤‘μ¬λ΅λ” νμ•• λ¨λ‹ν„°λ§μ„ λ§¤ 4μ‹κ°„λ§λ‹¤ μ‹¤μ‹ν•κ³ , μμ‚¬ μ§€μ‹μ— λ”°λΌ νμ•• μ΅°μ  μ•½λ¬Όμ„ ν¬μ—¬ν•¨. ν™μμ—κ² μ•½λ¬Ό λ³µμ© μΌμ •μ„ κ΄€λ¦¬ν•  μ μλ” λ°©λ²•μ„ μ•λ‚΄ν•κ³ , μ €μ—Όμ‹ μ‹λ‹¨κ³Ό κ·μΉ™μ μΈ μ΄λ™μ μ¤‘μ”μ„±μ— λ€ν•΄ κµμ΅ν•¨.\n\nμ¤ν›„ νμ•• μΈ΅μ • κ²°κ³Όλ” 150/92 mmHgλ΅ λ‹¤μ† μ•μ •λ κ²½ν–¥μ„ λ³΄μ„. ν™μλ” μ κ³µλ κµμ΅ λ‚΄μ©μ— λ€ν•΄ κΈμ •μ μΈ λ°μ‘μ„ λ³΄μ΄λ©°, μ•½λ¬Ό λ³µμ©κ³Ό μƒν™ μµκ΄€ κ°μ„ μ— λ€ν• μμ§€λ¥Ό ν‘ν„ν•¨. ν–¥ν›„ κ³„νμΌλ΅λ” μ§€μ†μ μΈ νμ•• λ¨λ‹ν„°λ§, μ•½λ¬Ό κ΄€λ¦¬ λ° ν™μ κµμ΅μ„ μ΄μ–΄κ° μμ •μ„."}
            ]
        
        def chat(text):
          user_input =  {"role":"user","content": text}
          prompt.append(user_input)
          answer = client.chat.completions.create(
            model="NursingAI",
            messages = prompt,
            temperature=0.2,
            max_tokens=1200,
            top_p=0.95,
            frequency_penalty=0,
            presence_penalty=0,
            stop=None)
        
          bot_answ = answer.choices[0].message.content
          bot_resp = {"role":"assistant","content": bot_answ}
          prompt.append(bot_resp)
          return bot_answ
        
        completion = client.chat.completions.create(
          model="NursingAI",
          messages = prompt,
          temperature=0.7,
          max_tokens=800,
          top_p=0.95,
          frequency_penalty=0,
          presence_penalty=0,
          stop=None
        )
        
        user_questions = [
            "λ‚™μƒ ν™μ κ°„νΈκΈ°λ΅ μ¨μ¤.",
            "λΉ„ν¨κ³Όμ  νΈν΅ μ–‘μ‚¬ ν™μμ Focus DAR κ°„νΈκΈ°λ΅ μ‘μ„±ν•΄μ¤.",
            "κΈ‰μ„± ν†µμ¦ ν™μ κ°„νΈκΈ°λ΅ μμ‹λ¥Ό SOAPIE κΈ°λ΅μ–‘μ‹μΌλ΅ μ‘μ„±ν•΄μ¤."
        ]
        
        candidates = [] # candidates ["First sentence", "Second sentence"]
        for question in user_questions:
          response = chat(question)
          candidates.append(response)
        
        # ν›„λ³΄κµ° λ¦¬μ¤νΈ μ¶λ ¥
        for i, candidate in enumerate(candidates):
          print(f"Question {i+1} : {user_questions[i]}")
          print(f"Answer: {candidate}\n")
        ```
        
    - κ²°κ³Ό μμ‹
        
        Narrative Note(μ–‘μ‹ λΉ„μ§€μ •)
        
        ![α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2023-12-14 α„‹α…©α„’α…® 3.12.15.png](Smart_nurse_Chatbot/narrnote.png)
        
        Focus DAR
        
        ![α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2023-12-14 α„‹α…©α„’α…® 3.12.38.png](Smart_nurse_Chatbot/focusdar.png)
        
        SOAPIE
        
        ![α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2023-12-14 α„‹α…©α„’α…® 3.12.49.png](Smart_nurse_Chatbot/soapie.png)
        

### c. LLM ν•™μµ

- GPT LLM ν•™μµ
    - λ¨λΈ μ„±λ¥
        
        > epoch = 3, μΌκ΄„μ²λ¦¬ν¬κΈ° = 4, ν•™μµ μ†λ„ μΉμ = 1
        > 
        
        Loss
        
        ![α„€α…³α„…α…µα†·1.png](Smart_nurse_Chatbot/model.png)
        

**μ΄μ & ν•κ³„μ **

- μ°λ¦¬κ°€ κ°€μ§„ κ°„νΈκΈ°λ΅ λ°μ΄ν„°λ΅ ν•™μµμ‹ν‚¨ LLM λ¨λΈμ„ deploy ν•΄λ„ prompting μ΄ μλ„ν• λ€λ΅ λ°μλμ§€ μ•μ
    - ν†µμΌλμ§€ μ•μ€ ν•­λ©λ…
    - λ©μ°¨ ν•μ‹ νΌμ¬(λ²νΈμ, bullet point λ“±)
    - λΉ„ν¨μ¨μ μΈ β€-μ…λ‹λ‹¤β€™ λ“±μ λ§μ—°μ²΄
    - μ „λ¬Έμ„±μ΄ λκ»΄μ§€μ§€ μ•λ” ν¬κ΄„μ μΈ λ‹µλ³€
    - κ°„νΈ κ΄€λ ¨ μ§λ¬Έμ΄ μ•„λ‹ κ²½μ°μ—λ„ μ„μμ κ°„νΈκΈ°λ΅ μ κ³µ
    - **ν•΄κ²°ν• λ°©λ²•**
        - prompt instruction μ„ λ”μ± μ •κµν™”
            
            ```python
            instruction_NANDA = """
            Persona:
            - You are a nursing assistant with the knowledge equivalent to a nurse with 10 years of experience.
            - When the user mentions a diagnosis, write a nursing record for that specific condition.
            - If the user asks questions not related to nursing records, respond in a way that guides them to ask questions about nursing-related topics.
            
            Instructions:
            - All responses should be in Korean.
            - Exclude any theoretical basis or guideline in 'κ°„νΈμν–‰/μ¤‘μ¬/μ΄λ΅ μ  κ·Όκ±° Interventions' section.
            - Write 'λ‹¨κΈ°λ©ν‘' and 'μ¥κΈ°λ©ν‘' as substructures under the 'κ°„νΈλ©ν‘ λ‹¨κΈ°/μ¥κΈ° Goal' section.
            - The content of each section should be specific and include precise numerical information. Instead of a general response like 'μ μ ν• νΈν΅ κΈ°λ²• κµμ΅,' provide specific details such as 'νΈν΅ μ΄λ™ κµμ΅: κΉκ³  μ²μ²ν μ¨μ‰¬κΈ°, λ³µμ‹νΈν΅λ²• κµμ΅.' Include exact figures, for example, 'ν™μμ νΈν΅μκ°€ 24μ‹κ°„ μ΄λ‚΄μ— λ¶„λ‹Ή 12~20νλ΅ μ •μƒ λ²”μ„ λ‚΄λ΅ κ°μ†.'
            - End all responses with a noun or a nominal ending. Change endings such as 'μµλ‹λ‹¤', 'ν•©λ‹λ‹¤', 'ν–λ‹¤', 'ν•λ‹¤', 'μ…λ‹λ‹¤', 'μλ‹¤', 'λ©λ‹λ‹¤', 'λλ‹¤' to 'μ', 'ν•¨', 'ν•¨', 'ν•¨', 'μ„', 'μμ', 'λ¨', 'λ¨' respectively.
            - Organize patient information and related sections in a list format, with line breaks. Each item should start with a bullet point and each section should contain only one substructure.
            - Write nursing records following the specified format below.
            ```
            
        - ν”„λ΅¬ν”„νΈ, μΈμ¤νΈλ­μ… fine-tuning λ°©ν–¥: κ°„νΈ μ‹¤λ¬΄ ν„μ¥μ„ κ³ λ ¤ν•΄ μ „λ¬Έμ μ΄λ©΄μ„λ„ ν¨μ¨μ μ΄κ³  κ°„νΈν• λ‹µλ³€ μ κ³µ
            - instruction μ„ μμ–΄λ΅ μ‘μ„±
            - aiμ— νλ¥΄μ†λ‚ λ¶€μ—¬(10λ…„μ°¨ κ°„νΈμ‚¬)
            - κΈ°λ΅μ–‘μ‹λ³„ μ‘μ„± ν•μ‹ ν†µμΌ(SmartNurse)
            - μ§€μ‹ λ‚΄μ© κµ¬μ²΄ν™” (μ–‘μ‹ λ³„ λ°λ“μ‹ ν¬ν•¨ν•΄μ•Ό ν•λ” λ‚΄μ© λ…μ‹ λ“±)
            - κ°„κ²°ν•κ³  μ „λ¬Έμ„±μ΄ λκ»΄μ§€λ” λ§ν¬(λ…μ‚¬ν• μΆ…κ²°μ–΄λ―Έ μ‚¬μ©)
            - μµλ€ν• κµ¬μ²΄μ μΌλ΅ κΈ°λ΅(μμΉ, μ •ν™•ν• μ΅°μΉλ… μ‚¬μ© λ“±)
            - κ°„νΈ κ΄€λ ¨ μ§λ¬Έμ΄ μ•„λ‹ κ²½μ° β†’ κ°„νΈκΈ°λ΅μ— λ€ν• μ§λ¬Έμ„ ν•  μ μλ„λ΅ μ λ„
            - LLM κΈ°λ° λ°μ΄ν„°κ°€ μ•„λ‹ μ •λ³΄ λ¬΄λ‹¨ μ κ³µ(Hallucination μ°λ ¤)
        - ν•™μµ λ°μ΄ν„°μ…‹μ μ§ ν–¥μƒ : prompt tuning μ— μ‚¬μ©ν• μ΄μƒμ μΈ λ‹µλ³€ λ°μ΄ν„°μ…‹μ„ μ¶”κ°€ν•μ—¬ LLM fine-tuning
- λ¨λΈ μ„±λ¥ν‰κ°€κ°€ μ–΄λ ¤μ›€ : LLM λ¨λΈμ— λ€ν• μ„±λ¥ν‰κ°€ λ°©λ²•μ— ν„μ‹¤μ μΈ ν•κ³„κ°€ μ΅΄μ¬ν•λ©°,  μ°λ¦¬ taskμ™€ κ°™μ€ μ–‘μ‹μ— λ§κ² μƒμ„±ν• λ‹µλ³€ κ²°κ³Όλ¥Ό ν‰κ°€ν•  μ •λ‰μ§€ν‘κ°€ λ¶€μ¬.
    - μ „λ¬Έκ°€μ— μν• μƒμ„± λ‹µλ³€ μ •ν™•μ„± ν‰κ°€
    - λλ” μ—¬λ¬κ°μ LLM λ¨λΈμ— κ°™μ€ prompt instruction μ„ μ£Όμ—μ„ λ• μƒμ„±λ κ²°κ³Όλ¥Ό μ„λ΅ λΉ„κµν•λ” λ°©λ²• λ“±μ„ μ‚¬μ©ν•  μ μμ.

---

# 4. μ„λΉ„μ¤ κµ¬ν„ λ° λ°°ν¬

### a. Chatbot : Langchain

- λ­μ²΄μΈμ„ ν™μ©ν• μ±—λ΄‡ μ½”λ“ κµ¬ν„
    - fine-tuning LLM λ¨λΈμ— κΈ°λ΅ μ–‘μ‹λ³„ few shot prompt ν•™μµ μ½”λ“ κµ¬ν„
    - μμ‹ : NANDA
        
        ```python
        # NANDA ver. ν”„λ΅¬ν”„νΈ, μΈμ¤νΈλ­μ… κµ¬μ„±
        examples_NANDA = [
            {"input": "λΉ„ν¨κ³Όμ  νΈν΅ μ–‘μƒ ν™μμ κ°„νΈκΈ°λ΅ NANDA μ–‘μ‹μΌλ΅ μ‘μ„±ν•΄μ¤.", "output": "ν™μ μ •λ³΄\n\nμ΄λ¦„: μ •μ¤μ§€\nλ‚μ΄: 35μ„Έ\nμ„±λ³„: μ—¬μ„±\n\nμλ£ μμ§‘ μ£Όκ΄€μ  / κ°κ΄€μ \n\nν™μμ ν‘μ •μ—μ„ νΈν΅κ³¤λ€ λλ‚\nν™μμ λ§μ—μ„ νΈν΅μ— μ–΄λ ¤μ›€μ„ νΈμ†\nνΈν΅μ λ¶„λ‹Ή 28ν, λΉ λ¥΄κ³  μ–•μ€ νΈν΅\nμ‚°μ†ν¬ν™”λ„ 89%, μ •μƒ λ²”μ„ μ΄ν•\nκ°€μ΄μ λΉ„μ •μƒμ μΈ νΈν΅ ν¨ν„΄ κ΄€μ°°\n\nκ°„νΈλ©ν‘ λ‹¨κΈ°/μ¥κΈ° Goal\nλ‹¨κΈ°λ©ν‘:\n\nν™μμ νΈν΅μκ°€ 24μ‹κ°„ μ΄λ‚΄μ— λ¶„λ‹Ή 12~20νλ΅ μ •μƒ λ²”μ„ λ‚΄λ΅ κ°μ†\nμ‚°μ†ν¬ν™”λ„κ°€ 24μ‹κ°„ μ΄λ‚΄μ— 95% μ΄μƒμΌλ΅ μ¦κ°€\nμ¥κΈ°λ©ν‘:\n\nν™μκ°€ 1μ£ΌμΌ μ΄λ‚΄μ— μ•μ •μ μΈ νΈν΅ ν¨ν„΄μ„ μ μ§€\nν™μκ°€ 1μ£ΌμΌ μ΄λ‚΄μ— μ£Όκ΄€μ  νΈν΅ λ¶νΈκ°μ΄ κ°μ†\nκ°„νΈκ³„ν Plan\n\nμ •κΈ°μ μΈ νΈν΅ ν¨ν„΄ λ° μ‚°μ†ν¬ν™”λ„ λ¨λ‹ν„°λ§\nμ‚°μ†μ”λ²• μ‹¤μ‹\nνΈν΅ μ΄λ™ κµμ΅: κΉκ³  μ²μ²ν μ¨μ‰¬κΈ°, λ³µμ‹νΈν΅λ²• κµμ΅\nλ¶μ• κ°μ†λ¥Ό μ„ν• ν™κ²½ μ΅°μ  λ° μ‹¬λ¦¬μ  μ§€μ§€ μ κ³µ\n\nκ°„νΈμν–‰/μ¤‘μ¬/μ΄λ΅ μ  κ·Όκ±° Interventions\n\nνΈν΅μ λ° μ‚°μ†ν¬ν™”λ„ μΈ΅μ • μ£ΌκΈ° μ„¤μ •\nμ‚°μ†μ”λ²• μ‹¤μ‹: μ‚°μ† νλ¦„λ¥  μ΅°μ \nνΈν΅ μ΄λ™ μ‹¤μ‹: μΌμΌ 3ν, κ° 10λ¶„κ°„\nν™μμ μ•μ •μ„ μ„ν• μ΅°μ©ν•κ³  νΈμ•ν• ν™κ²½ μ΅°μ„±\n\nκ°„νΈν‰κ°€ Evaluation\n\nνΈν΅μ λ° μ‚°μ†ν¬ν™”λ„ λ³€ν™” μ¶”μ \nνΈν΅ μ΄λ™ μ‹¤μ‹ μ—¬λ¶€ λ° ν¨κ³Ό ν‰κ°€\nν™μμ νΈν΅ λ¶νΈκ° κ°μ† μ •λ„ ν‰κ°€\nμ‚°μ†μ”λ²•μ ν¨κ³Όμ„± ν‰κ°€"},
            {"input": "λΉ„ν¨κ³Όμ  κΈ°λ„ μ²­κ²° ν™μμ κ°„νΈκΈ°λ΅ NANDA μ–‘μ‹μΌλ΅ μ‘μ„±ν•΄μ¤.", "output": "ν™μ μ •λ³΄\n μ΄λ¦„: μ΄μƒμ§„\n λ‚μ΄: 45μ„Έ\n μ„±λ³„: λ‚¨μ„±\n\nμλ£ μμ§‘ μ£Όκ΄€μ  / κ°κ΄€μ \n\nν™μμ κΈ°μΉ¨μ΄ μ•½ν•κ³  λΉ„ν¨κ³Όμ μ„\nκ°€λ λ°°μ¶μ— μ–΄λ ¤μ›€ νΈμ†\nμ²­μ§„ μ‹ λ―Έμ„Έν• μ²λ…μ λ“¤λ¦Ό\nνΈν΅μ‹ κ°€μ΄μ μ–‘μ½μ΄ λ¶κ· ν•ν•κ² ν™•μ¥λ¨\nμ‚°μ†ν¬ν™”λ„ 92%, μ •μƒ λ²”μ„λ³΄λ‹¤ λ‚®μ\n\nκ°„νΈλ©ν‘ λ‹¨κΈ°/μ¥κΈ° Goal\nλ‹¨κΈ°λ©ν‘\n\nν™μμ μ‚°μ†ν¬ν™”λ„κ°€ 24μ‹κ°„ μ΄λ‚΄μ— 95% μ΄μƒμΌλ΅ μ¦κ°€\n24μ‹κ°„ μ΄λ‚΄μ— κ°€λ λ°°μ¶μ΄ μ›ν™ν•΄μ§\nμ¥κΈ°λ©ν‘\n\n1μ£ΌμΌ μ΄λ‚΄μ— κΈ°μΉ¨μ ν¨κ³Όμ„± μ¦κ°€\n1μ£ΌμΌ μ΄λ‚΄μ— μ²­μ§„ μ‹ μ²λ…μ κ°μ†\n\nκ°„νΈκ³„ν Plan\n\nμ •κΈ°μ μΈ νΈν΅ μƒνƒ λ° μ‚°μ†ν¬ν™”λ„ λ¨λ‹ν„°λ§\nκΈ°λ„ μ²­κ²°μ„ μ„ν• κ°€μµκΈ° μ‚¬μ©\nκΈ°μΉ¨ λ° μ‹¬νΈν΅ μ΄λ™ μ§€λ„\nμ²΄μ„ λ°°μ•΅μ (CPT) μ‹¤μ‹\n\nκ°„νΈμν–‰/μ¤‘μ¬/μ΄λ΅ μ  κ·Όκ±° Interventions\n\nνΈν΅ μƒνƒ λ° μ‚°μ†ν¬ν™”λ„ λ§¤μ‹κ°„ ν™•μΈ\nκ°€μµκΈ° μ‚¬μ©ν•μ—¬ κ³µκΈ°μ μµλ„ μ΅°μ \nκΈ°μΉ¨ λ° μ‹¬νΈν΅ μ΄λ™: ν•λ£¨ 3ν, κ° 10λ¶„κ°„ μ‹¤μ‹\nμ²΄μ„ λ°°μ•΅μ : ν•λ£¨ 2ν, κ° 15λ¶„κ°„ μ‹¤μ‹\n\nκ°„νΈν‰κ°€ Evaluation\n\nμ‚°μ†ν¬ν™”λ„ λ° νΈν΅ ν¨ν„΄ λ³€ν™” μ¶”μ \nκ°€λ λ°°μ¶μ μ›ν™ν•¨ ν‰κ°€\nκΈ°μΉ¨μ ν¨κ³Όμ„± ν‰κ°€\nμ²΄μ„ λ°°μ•΅μ μ ν¨κ³Ό ν‰κ°€"},
            {"input": "κ°€μ¤ κµν™ μ¥μ•  ν™μμ κ°„νΈκΈ°λ΅ NANDA μ–‘μ‹μΌλ΅ μ‘μ„±ν•΄μ¤.", "output": "ν™μ μ •λ³΄\n μ΄λ¦„: μ •νΈμ„\n λ‚μ΄: 32μ„Έ\n μ„±λ³„: λ‚¨μ„±\n\nμ§„λ‹¨: κ°€μ¤ κµν™ μ¥μ•  (NANDA-I #00030)\n\nμλ£ μμ§‘ μ£Όκ΄€μ  / κ°κ΄€μ \n\nν™μκ°€ νΈν΅ μ‹ ν”Όλ΅κ° νΈμ†\nν”Όλ¶€μ™€ μ…μ μ μ²­μƒ‰μ¦ κ΄€μ°°\nλ™λ§¥ν κ°€μ¤ λ¶„μ„μ—μ„ PaO2 55 mmHg, PaCO2 50 mmHgλ΅ μ΄μƒμΉ λ³΄μ„\nμ‚°μ†ν¬ν™”λ„ 88%, μ •μƒ λ²”μ„ μ΄ν•\nμ²­μ§„ μ‹ νΈν΅μ κ°μ† λ° λΉ„μ •μƒμ  νΈν΅ μ†λ¦¬ κ΄€μ°°\n\nκ°„νΈλ©ν‘ λ‹¨κΈ°/μ¥κΈ° Goal\nλ‹¨κΈ°λ©ν‘\n\nν™μμ μ‚°μ†ν¬ν™”λ„κ°€ 24μ‹κ°„ μ΄λ‚΄μ— 95% μ΄μƒμΌλ΅ μ¦κ°€\nλ™λ§¥ν κ°€μ¤ λ¶„μ„μΉκ°€ 48μ‹κ°„ μ΄λ‚΄μ— μ •μƒ λ²”μ„λ΅ νλ³µ\nμ¥κΈ°λ©ν‘\n\n1μ£ΌμΌ μ΄λ‚΄μ— νΈν΅ λ¶νΈκ° κ°μ†\n1μ£ΌμΌ μ΄λ‚΄μ— μ²­μƒ‰μ¦μ΄ μ—†μ–΄μ§\n\nκ°„νΈκ³„ν Plan\n\nμ •κΈ°μ μΈ μ‚°μ†ν¬ν™”λ„ λ° λ™λ§¥ν κ°€μ¤ λ¨λ‹ν„°λ§\nμ μ ν• μ‚°μ†μ”λ²• μ‹¤μ‹\nνΈν΅ μ΄λ™ λ° μ²΄μ„ λ³€κ²½ μ§€λ„\nμ μ ν• μμ–‘ λ° μλ¶„ μ„­μ·¨ μ§€μ›\n\nκ°„νΈμν–‰/μ¤‘μ¬/μ΄λ΅ μ  κ·Όκ±° Interventions\n\nμ‚°μ†ν¬ν™”λ„ λ° λ™λ§¥ν κ°€μ¤ λ§¤ 2μ‹κ°„λ§λ‹¤ ν™•μΈ\nμ‚°μ† νλ¦„λ¥  μ΅°μ ν•μ—¬ μ‚°μ†μ”λ²• μ‹¤μ‹\nνΈν΅ μ΄λ™: ν•λ£¨ 3ν, κ° 10λ¶„κ°„ μ‹¤μ‹\nμ²΄μ„ λ³€κ²½: 2μ‹κ°„λ§λ‹¤ ν• λ²μ”© μ‹¤μ‹\n\nκ°„νΈν‰κ°€ Evaluation\n\nμ‚°μ†ν¬ν™”λ„ λ° λ™λ§¥ν κ°€μ¤μ λ³€ν™” μ¶”μ \nνΈν΅ μ΄λ™κ³Ό μ²΄μ„ λ³€κ²½μ ν¨κ³Ό ν‰κ°€\nνΈν΅ λ¶νΈκ° λ° μ²­μƒ‰μ¦μ κ°μ† μ •λ„ ν‰κ°€\nμ‚°μ†μ”λ²•μ ν¨κ³Όμ„± ν‰κ°€"},
            {"input": "λ‚™μƒ μ„ν— ν™μμ κ°„νΈκΈ°λ΅ NANDA μ–‘μ‹μΌλ΅ μ‘μ„±ν•΄μ¤.", "output": "ν™μ μ •λ³΄\n μ΄λ¦„: μ΄μ¤μ•„\n λ‚μ΄: 67μ„Έ\n μ„±λ³„: μ—¬μ„±\n\nμ§„λ‹¨: λ‚™μƒ μ„ν— (NANDA-I #00155)\n\nμλ£ μμ§‘ μ£Όκ΄€μ  / κ°κ΄€μ \n\nν™μκ°€ λ³΄ν–‰ μ‹ λ¶μ•μ •ν•¨ νΈμ†\nμµκ·Όμ— ν• λ² λ‚™μƒ κ²½ν— μμ\nκ·Όλ ¥ μ•½ν™” λ° κ· ν• μ μ§€ μ–΄λ ¤μ›€ κ΄€μ°°\nμ•½λ¬Ό λ³µμ© μ¤‘ (μ•½λ¬Όλ… λ° μ©λ‰), λ‚™μƒ μ„ν— μ¦κ°€ κ°€λ¥μ„±\nμΌμƒμƒν™ ν™λ™(ADL) μν–‰ μ‹ λ„μ›€ ν•„μ”\n\nκ°„νΈλ©ν‘ λ‹¨κΈ°/μ¥κΈ° Goal\n\nλ‹¨κΈ°λ©ν‘\n\n24μ‹κ°„ μ΄λ‚΄μ— μ¶”κ°€μ μΈ λ‚™μƒ μ—†μ\n48μ‹κ°„ μ΄λ‚΄μ— μ•μ „ν• λ³΄ν–‰κΈ°μ  μµλ“\nμ¥κΈ°λ©ν‘\n\n1μ£ΌμΌ μ΄λ‚΄μ— λ…λ¦½μ μΈ λ³΄ν–‰ λ¥λ ¥ ν–¥μƒ\n1κ°μ›” μ΄λ‚΄μ— λ‚™μƒ μ‚¬κ³  μ—†μ\n\nκ°„νΈκ³„ν Plan\n\nμ •κΈ°μ μΈ λ‚™μƒ μ„ν— ν‰κ°€\nλ‚™μƒ μλ°© κµμ΅ λ° ν™κ²½ μ΅°μ •\nλ³΄μ΅°κΈ°κµ¬ μ‚¬μ© κµμ΅ λ° μ κ³µ\nκ·Όλ ¥ κ°•ν™” λ° κ· ν• ν–¥μƒ μ΄λ™ μ§€λ„\nκ°„νΈμν–‰/μ¤‘μ¬/μ΄λ΅ μ  κ·Όκ±° Interventions\n\nλ‚™μƒ μ„ν— ν‰κ°€: λ§¤μΌ μ‹¤μ‹\nλ‚™μƒ μλ°© κµμ΅: ν™μ λ° κ°€μ΅± λ€μƒμΌλ΅ μ§„ν–‰\nλ³΄μ΅°κΈ°κµ¬ μ‚¬μ©λ²• κµμ΅: ν•„μ”μ‹ μ¦‰μ‹ μ κ³µ\nκ·Όλ ¥ κ°•ν™” λ° κ· ν• μ΄λ™: ν•λ£¨ 2ν, κ° 15λ¶„κ°„ μ‹¤μ‹\n\nκ°„νΈν‰κ°€ Evaluation\n\nμ¶”κ°€μ μΈ λ‚™μƒ μ‚¬κ³  μ—¬λ¶€ ν™•μΈ\nλ³΄ν–‰κΈ°μ  λ° λ³΄μ΅°κΈ°κµ¬ μ‚¬μ© ν¨κ³Ό ν‰κ°€\nκ·Όλ ¥ κ°•ν™” λ° κ· ν• μ΄λ™μ ν¨κ³Όμ„± ν‰κ°€\nλ‚™μƒ μλ°© κµμ΅μ μ΄ν•΄λ„ λ° μ μ© μ—¬λ¶€ ν‰κ°€"}
        ]
        few_shot_prompt_NANDA = FewShotChatMessagePromptTemplate(
            example_prompt=example_prompt,
            examples=examples_NANDA 
        )
        instruction_NANDA = """
        Persona:
        - You are a nursing assistant with the knowledge equivalent to a nurse with 10 years of experience.
        - When the user mentions a diagnosis, write a nursing record for that specific condition.
        - If the user asks questions not related to nursing records, respond in a way that guides them to ask questions about nursing-related topics.
        
        Instructions:
        - All responses should be in Korean.
        - Exclude any theoretical basis or guideline in 'κ°„νΈμν–‰/μ¤‘μ¬/μ΄λ΅ μ  κ·Όκ±° Interventions' section.
        - Write 'λ‹¨κΈ°λ©ν‘' and 'μ¥κΈ°λ©ν‘' as substructures under the 'κ°„νΈλ©ν‘ λ‹¨κΈ°/μ¥κΈ° Goal' section.
        - The content of each section should be specific and include precise numerical information. Instead of a general response like 'μ μ ν• νΈν΅ κΈ°λ²• κµμ΅,' provide specific details such as 'νΈν΅ μ΄λ™ κµμ΅: κΉκ³  μ²μ²ν μ¨μ‰¬κΈ°, λ³µμ‹νΈν΅λ²• κµμ΅.' Include exact figures, for example, 'ν™μμ νΈν΅μκ°€ 24μ‹κ°„ μ΄λ‚΄μ— λ¶„λ‹Ή 12~20νλ΅ μ •μƒ λ²”μ„ λ‚΄λ΅ κ°μ†.'
        - End all responses with a noun or a nominal ending. Change endings such as 'μµλ‹λ‹¤', 'ν•©λ‹λ‹¤', 'ν–λ‹¤', 'ν•λ‹¤', 'μ…λ‹λ‹¤', 'μλ‹¤', 'λ©λ‹λ‹¤', 'λλ‹¤' to 'μ', 'ν•¨', 'ν•¨', 'ν•¨', 'μ„', 'μμ', 'λ¨', 'λ¨' respectively.
        - Organize patient information and related sections in a list format, with line breaks. Each item should start with a bullet point and each section should contain only one substructure.
        - Write nursing records following the specified format below.
        
        format:
        ###
        ν™μ μ •λ³΄
        - μ΄λ¦„: [μ΄λ¦„]
        - λ‚μ΄: [λ‚μ΄]
        - μ„±λ³„: [μ„±λ³„]
        
        μλ£ μμ§‘ μ£Όκ΄€μ  / κ°κ΄€μ 
        - ν•μ„κµ¬μ΅°
        
        κ°„νΈλ©ν‘ λ‹¨κΈ°/μ¥κΈ° Goal
        - ν•μ„κµ¬μ΅°
        
        κ°„νΈκ³„ν Plan
        - ν•μ„κµ¬μ΅°
        
        κ°„νΈμν–‰/μ¤‘μ¬/μ΄λ΅ μ  κ·Όκ±° Interventions
        - ν•μ„κµ¬μ΅°
        
        κ°„νΈν‰κ°€ Evaluation
        - ν•μ„κµ¬μ΅°
        ###
        """
        final_prompt_NANDA = ChatPromptTemplate.from_messages(
            [
                ("system", instruction_NANDA),
                few_shot_prompt_NANDA,
                ("human", "{input}"),
            ]
        )
        ```
        

### b. Webapp deployment : Streamlit

- μ›Ήμ•± λ°°ν¬λ¥Ό μ„ν• Streamlit μ½”λ“ κµ¬ν„
    - chat-input
    - μ½”λ“
        
        ```python
        # λ¨λΈ μ¤€λΉ„, μ λ° ν™κ²½ λ§λ ¨
        class ChatCallbackHandler(BaseCallbackHandler):
            message = ""
            
            def on_llm_start(self, *args, **kwargs):
                with st.chat_message('ai') :
                    self.message_box = st.empty()
        
            def on_llm_end(self, *args, **kwargs):
                save_message(self.message, "ai")
                
            def on_llm_new_token(self, token, *args, **kwargs):
                self.message += token
                self.message_box.markdown(self.message)
                
        azure = AzureChatOpenAI(
            temperature=0.2,
            streaming=True,
            callbacks=[
                ChatCallbackHandler()]
        )
        
        def save_message(message, role):
            st.session_state["messages"].append({"message": message, "role": role})
        
        def send_message(message, role, save=True):
            with st.chat_message(role):
                st.markdown(message)
            if save:
                save_message(message, role)
                
        def paint_history():
            for message in st.session_state["messages"]:
                send_message(
                    message["message"],
                    message["role"],
                    save=False,
                )
        
        ###λ­μ²΄μΈ ν”„λ΅¬ν”„νΈ μ½”λ“ μ‚½μ…### 
        
        # λ©”μ‹μ§€ μ…λ ¥ λ° μ²λ¦¬
        if 'messages' not in st.session_state:
            st.session_state["messages"] = []
        
        paint_history()
        
        def handle_chat(message, format_option):
            if format_option == 'NANDA':
                prompt = final_prompt_NANDA
            elif format_option == 'SOAPIE':
                prompt = final_prompt_SOAPIE
            elif format_option == 'Focus DAR':
                prompt = final_prompt_FocusDAR
            elif format_option == 'Narrative Note':
                prompt = final_prompt_NN
            else:
                st.error("ν¬λ§·μ΄ μ„ νƒλμ§€ μ•μ•μµλ‹λ‹¤.")
                return None
        
            send_message(message, "human")
            chain = prompt | azure
            return chain.invoke({"input": message, "output": ""})
        
        message = st.chat_input("μμ‹: ν†µμ¦ ν™μμ κ°„νΈκΈ°λ΅μ„ μ‘μ„±ν•΄μ¤.")
        if message:
            response = handle_chat(message, format_option)
        
        ```
        
    - chatbot UI
    - μ½”λ“
        
        ```python
        # μ›Ή νƒ­ κΎΈλ―ΈκΈ°
        st.set_page_config(
            page_title="SmartNurse ChatBot",
            page_icon="π‘©β€β•οΈ",
        
        # UI κµ¬ν„
        st.title("SmartNurse ENR Chatbot")
        st.subheader('μ¤λ§νΈλ„μ¤ ENR μ±—λ΄‡μ—κ² λ„μ›€μ„ μ”μ²­ν•μ„Έμ”.')
        st.markdown('μ§λ³‘κ³Ό μ–‘μ‹μ„ μ…λ ¥ν•λ©΄ κ°„νΈ κΈ°λ΅ μμ‹κ°€ μƒμ„±λ©λ‹λ‹¤.\n μ™Όμ½ λ©”λ‰΄λ¥Ό μ—΄μ–΄ μ–‘μ‹μ„ μ„ νƒν•΄ μ£Όμ„Έμ”.')
        
        # cssλ΅ κΎΈλ―ΈκΈ°
        st.markdown("""
        <style>
        h1{
            color : rgb(6 161 54);
            }
        }
        </style> 
        """, unsafe_allow_html=True)
        
        # μ‚¬μ΄λ“λ°”, μ…€λ ‰νΈλ°•μ¤ μ¶”κ°€
        with st.sidebar:
            format = ['NANDA', 'SOAPIE', 'Focus DAR', 'Narrative Note']
            format_option = st.selectbox("", format,
                index=None,
                placeholder="κΈ°λ΅ μ–‘μ‹μ„ μ„ νƒν•΄ μ£Όμ„Έμ”.",
                label_visibility="visible"
                )
            st.write('μ„ νƒ: ', format_option)
        ```
        
- λ°λ¨
    
    ![μ±—λ΄‡ λ©”μΈ](Smart_nurse_Chatbot/chatbot_page.png)
    
    μ±—λ΄‡ λ©”μΈ
    
    ![μ‚¬μ©μ μ…λ ¥ μΏΌλ¦¬ β†’ μμ‹ μƒμ„±](Smart_nurse_Chatbot/chatbot_ex.png)
    
    μ‚¬μ©μ μ…λ ¥ μΏΌλ¦¬ β†’ μμ‹ μƒμ„±
    

[μ›Ήμ•± μ‹¤ν–‰ λ°λ¨ μμƒ](Smart_nurse_Chatbot/final_(1).mp4)

μ›Ήμ•± μ‹¤ν–‰ λ°λ¨ μμƒ

**μ΄μ & ν•κ³„μ **

μλ§μ€ μ—λ¬μ™€μ μ‹Έμ›€β€¦β€¦β€¦λ””λ²„κΉ…λ””λ²„κΉ…λ””λ²„κΉ…

###
